<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>BUSAN HAK PORT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="ë¶€ì‚°í•­ ì‘ì—…ì ì •ë³´ ê³µìœ  ê²Œì‹œíŒ" />
</head>

<body>
  <h1>ğŸ“¢ BUSAN HAK PORT</h1>

  <section>
    <h2>ê¸€ ì‘ì„±</h2>
    <input id="title" placeholder="ì œëª©" /><br /><br />
    <input id="name" placeholder="ì‘ì„±ì" /><br /><br />
    <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" /><br /><br />
    <textarea id="content" placeholder="ë‚´ìš©"></textarea><br /><br />
    <button onclick="addPost()">ë“±ë¡</button>
  </section>

  <hr />

  <section>
    <h2>ê²Œì‹œíŒ</h2>
    <ul id="postList"></ul>
  </section>

  <!-- Firebase v9 ONLY -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      onSnapshot,
      query,
      orderBy,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    // ğŸ”‘ Firebase ì„¤ì • (ì½˜ì†”ì—ì„œ ë³µì‚¬í•´ì„œ ì±„ìš°ê¸°)
    const firebaseConfig = {
      apiKey: "ì—¬ê¸°ì—_API_KEY",
      authDomain: "ì—¬ê¸°ì—_PROJECT.firebaseapp.com",
      projectId: "ì—¬ê¸°ì—_PROJECT_ID",
      storageBucket: "ì—¬ê¸°ì—_PROJECT.appspot.com",
      messagingSenderId: "ì—¬ê¸°ì—_SENDER_ID",
      appId: "ì—¬ê¸°ì—_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // âœ… ê¸€ ë“±ë¡
    window.addPost = async () => {
      const title = document.getElementById("title").value.trim();
      const name = document.getElementById("name").value.trim();
      const password = document.getElementById("password").value.trim();
      const content = document.getElementById("content").value.trim();

      if (!title || !name || !password || !content) {
        alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”");
        return;
      }

      await addDoc(collection(db, "posts"), {
        title,
        name,
        password,
        content,
        createdAt: serverTimestamp()
      });

      document.getElementById("title").value = "";
      document.getElementById("name").value = "";
      document.getElementById("password").value = "";
      document.getElementById("content").value = "";

      alert("ê¸€ ë“±ë¡ ì™„ë£Œ");
    };

    // âœ… ê²Œì‹œê¸€ ì‹¤ì‹œê°„ ë¡œë“œ
    const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
    onSnapshot(q, (snapshot) => {
      const list = document.getElementById("postList");
      list.innerHTML = "";
      snapshot.forEach((doc) => {
        const d = doc.data();
        const li = document.createElement("li");
        li.innerHTML = `
          <strong>${d.title}</strong><br/>
          ${d.content}<br/>
          <small>${d.name}</small>
          <hr/>
        `;
        list.appendChild(li);
      });
    });
  </script>

  <!-- PWA -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>
</body>
</html>
