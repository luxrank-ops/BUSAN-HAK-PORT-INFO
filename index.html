<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BUSAN HAK PORT INFO</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1060846766" crossorigin="anonymous"></script>

    <link rel="icon" type="image/png" sizes="32x32" href="icon.png?v=final2">
    <link rel="icon" type="image/png" sizes="192x192" href="icon.png?v=final2">
    <link rel="apple-touch-icon" sizes="180x180" href="icon.png?v=final2">
    <link rel="shortcut icon" href="icon.png?v=final2">
    <link rel="manifest" href="manifest.json?v=final2">

    <meta name="theme-color" content="#2c3e50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        :root {
            --primary: #2c3e50; --secondary: #34495e; --accent: #3498db;
            --warning: #f39c12; --danger: #e74c3c; --success: #27ae60;
            --bg: #ecf0f1; --card-bg: #ffffff; --text: #2c3e50;
            --border: #bdc3c7; --shadow: 0 4px 6px rgba(0,0,0,0.07);
        }
        body.dark-mode {
            --primary: #ecf0f1; --secondary: #bdc3c7; --accent: #5dade2;
            --bg: #1a1a1a; --card-bg: #2c3e50; --text: #ecf0f1;
            --border: #465c71; --shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Pretendard', 'Noto Sans KR', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 0; padding-bottom: 80px; transition: background-color 0.3s, color 0.3s; }

        header { background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d); background-size: 200% 200%; animation: gradientBG 10s ease infinite; color: white; padding: 15px 0; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.2); position: sticky; top: 0; z-index: 100; }
        @keyframes gradientBG { 0% {background-position:0% 50%} 50% {background-position:100% 50%} 100% {background-position:0% 50%} }
        header h1 { margin: 0; font-size: 1.5rem; letter-spacing: 1px; font-weight: 900; text-shadow: 0 2px 0 #333, 0 3px 5px rgba(0,0,0,0.3); animation: floatText 3s ease-in-out infinite alternate; }
        @keyframes floatText { from { transform: translateY(0); } to { transform: translateY(-2px); } }
        .theme-toggle { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.2); border: none; width: 36px; height: 36px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; color: white; display: flex; align-items: center; justify-content: center; }

        .ticker-container { background-color: var(--warning); color: #000; height: 40px; display: flex; align-items: center; overflow: hidden; position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.1); font-size: 0.9rem; }
        .ticker-wrap { width: 100%; overflow: hidden; padding-right: 80px; }
        .ticker-item { display: inline-block; white-space: nowrap; padding-left: 100%; animation: ticker 25s linear infinite; font-weight: bold; line-height: 40px; }
        @keyframes ticker { 100% { transform: translate3d(-100%, 0, 0); } }
        .ticker-controls { position: absolute; right: 0; height: 100%; display: flex; }
        .ticker-btn { width: 40px; height: 100%; border: none; background: rgba(0,0,0,0.1); font-size: 1.1rem; cursor: pointer; color: #fff; border-left: 1px solid rgba(255,255,255,0.3); display: flex; align-items: center; justify-content: center; }

        .container { width: 96%; max-width: 800px; margin: 15px auto; }
        .card { background: var(--card-bg); border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: var(--shadow); border: 1px solid var(--border); transition: transform 0.2s; }
        
        .section-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--bg); padding-bottom: 10px; margin-bottom: 10px; cursor: pointer; }
        .section-title { font-size: 1.1rem; font-weight: 800; color: var(--text); display: flex; align-items: center; gap: 5px; }
        .toggle-icon { font-size: 0.9rem; color: var(--accent); transition: transform 0.3s; }
        .toggle-icon.rotated { transform: rotate(180deg); }
        .collapsible-content { display: block; animation: fadeIn 0.3s ease-in-out; }
        .collapsible-content.collapsed { display: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

        .terminal-block { margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 12px; }
        .terminal-block:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .terminal-title { font-size: 0.95rem; font-weight: 700; color: var(--primary); margin: 0 0 8px 0; display: flex; align-items: center; }
        .terminal-title::before { content: 'âš“'; margin-right: 5px; font-size: 0.8rem; opacity: 0.7; }
        .terminal-actions { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .terminal-btn { background: var(--bg); border: 1px solid var(--border); color: var(--text); padding: 10px 5px; border-radius: 8px; text-decoration: none; font-size: 0.85rem; text-align: center; display: flex; align-items: center; justify-content: center; gap: 4px; font-weight: 500; transition: all 0.1s; }
        .terminal-btn:active { background: var(--border); transform: scale(0.98); }

        .dashboard-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .dash-btn { background: var(--bg); border: 1px solid var(--border); color: var(--text); padding: 12px 5px; border-radius: 8px; text-decoration: none; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 600; text-align: center; height: 70px; transition: all 0.1s active; }
        .dash-btn:active { transform: scale(0.97); background: var(--border); }
        .dash-btn span { font-size: 1.2rem; margin-bottom: 4px; }
        
        .tab-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .tab-btn { background: var(--card-bg); border: 1px solid var(--accent); color: var(--accent); padding: 12px; border-radius: 8px; font-weight: bold; text-align: center; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.05); font-size: 0.9rem; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .tab-btn.active { background: var(--accent); color: white; }
        .tab-sub { font-size: 0.7rem; font-weight: normal; margin-top: 2px; opacity: 0.8; }

        .form-box { background: var(--bg); padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid var(--border); }
        .input-field { width: 100%; padding: 12px; margin-bottom: 8px; border: 1px solid var(--border); border-radius: 6px; background: var(--card-bg); color: var(--text); font-size: 0.95rem; }
        .textarea-field { height: 100px; resize: none; }
        .action-btn { width: 100%; padding: 12px; border: none; border-radius: 6px; font-weight: bold; font-size: 1rem; cursor: pointer; color: white; background: var(--primary); transition: opacity 0.2s; }
        .action-btn:active { opacity: 0.8; }
        .bg-submit { background-color: var(--success); }
        .bg-cancel { background-color: var(--secondary); margin-top: 5px; }
        .bg-calc { background-color: var(--danger); }

        .wage-label { font-size: 0.85rem; color: var(--text); font-weight: bold; margin-bottom: 5px; display: block; margin-top: 10px;}
        .wage-row { display: flex; gap: 10px; margin-bottom: 5px; align-items: center;}
        .wage-row label { flex: 1; font-size: 0.9rem; font-weight: bold; }
        .wage-row .input-field { flex: 1.5; margin-bottom: 0; text-align: right; }
        .wage-unit { font-size: 0.8rem; color: #666; margin-left: 5px; min-width: 30px;}
        .wage-result-box { background: #fff3e0; border: 2px solid #ff9800; border-radius: 8px; padding: 15px; text-align: center; margin-top: 15px; }
        .wage-total { font-size: 1.8rem; color: #d35400; font-weight: 900; letter-spacing: -1px;}

        .post-list { list-style: none; padding: 0; margin: 0; }
        .post-item { background: var(--card-bg); border-bottom: 1px solid var(--border); padding: 15px; cursor: pointer; }
        .post-item:first-child { border-top-left-radius: 8px; border-top-right-radius: 8px; }
        .post-item:last-child { border-bottom: none; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; }
        .post-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .post-main { flex: 1; }
        .post-title { font-weight: bold; font-size: 0.95rem; margin-bottom: 4px; display: block; color: var(--primary); }
        .post-meta { font-size: 0.75rem; color: #7f8c8d; }
        .post-actions { display: flex; gap: 5px; align-items: center; }
        .mini-btn { padding: 4px 8px; font-size: 0.75rem; border-radius: 4px; border: none; cursor: pointer; color: white; }
        .btn-edit { background: var(--accent); }
        .btn-del { background: var(--danger); }
        .btn-photo { background: var(--success); }
        .post-body { display: none; margin-top: 10px; padding-top: 10px; border-top: 1px dashed var(--border); font-size: 0.9rem; line-height: 1.5; color: var(--text); }

        .file-label { display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; padding: 12px; background: #e8f6f3; border: 2px dashed #1abc9c; border-radius: 6px; color: #16a085; font-weight: bold; cursor: pointer; margin-bottom: 8px; }
        .preview-box { text-align: center; margin-bottom: 10px; display: none; }
        .preview-box img { max-width: 100px; border-radius: 4px; border: 1px solid var(--border); }
        .tag-cloud { display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 10px; }
        .tag-chip { background: var(--card-bg); border: 1px solid var(--border); padding: 4px 10px; border-radius: 15px; font-size: 0.75rem; cursor: pointer; color: var(--secondary); }

        /* [ê´‘ê³  ì˜ì—­ ìŠ¤íƒ€ì¼] */
        .ad-placeholder {
            background-color: var(--bg); border: 1px solid var(--border); border-radius: 8px;
            padding: 10px; text-align: center; margin-bottom: 15px; overflow: hidden;
        }

        #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 25px; padding: 16px; position: fixed; z-index: 2000; left: 50%; bottom: 80px; transform: translateX(-50%); font-size: 0.9rem; box-shadow: 0 4px 10px rgba(0,0,0,0.3); opacity: 0; transition: opacity 0.3s; }
        #toast.show { visibility: visible; opacity: 1; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; background: var(--card-bg); border-top: 1px solid var(--border); display: flex; justify-content: space-around; align-items: center; z-index: 1000; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { flex: 1; text-align: center; color: #95a5a6; font-size: 0.7rem; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .nav-icon { font-size: 1.4rem; margin-bottom: 2px; }
        .hidden { display: none; }
        .pagination { display: flex; justify-content: center; gap: 5px; margin-top: 15px; }
        .page-num { padding: 5px 10px; background: var(--card-bg); border: 1px solid var(--border); border-radius: 4px; cursor: pointer; }
        .page-num.active { background: var(--primary); color: white; border-color: var(--primary); }
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 3000; justify-content: center; align-items: center; }
        .modal-content { background: var(--card-bg); padding: 15px; border-radius: 10px; max-width: 90%; max-height: 80%; overflow-y: auto; text-align: center; }
        .modal-img { max-width: 100%; border-radius: 5px; }
    </style>
</head>
<body>

    <header>
        <h1>BUSAN HAK PORT</h1>
        <button class="theme-toggle" onclick="toggleDarkMode()">ğŸŒ™</button>
    </header>

    <div id="safetyTicker" class="ticker-container hidden">
        <div class="ticker-wrap"><div id="tickerText" class="ticker-item"></div></div>
        <div class="ticker-controls">
            <button class="ticker-btn" onclick="updateBanner()">âœï¸</button>
            <button class="ticker-btn" onclick="openBannerAdmin()">âš™ï¸</button>
        </div>
    </div>

    <div class="container">
        <div id="section-community" class="card">
            <div class="section-header" onclick="toggleSection('comm-content', this)">
                <span class="section-title">ğŸ“Š í˜„ì¥ ì •ë³´ & ì»¤ë®¤ë‹ˆí‹°</span>
                <span class="toggle-icon">â–¼</span>
            </div>
            
            <div id="comm-content" class="collapsible-content">
                <div class="tab-grid">
                    <div class="tab-btn" onclick="toggleTab('noticeArea', this)">ğŸ“¢ ê³µì§€ì‚¬í•­</div>
                    <div class="tab-btn" onclick="toggleTab('boardArea', this)">ğŸ’¬ ìµëª… ê²Œì‹œíŒ<div class="tab-sub">(ê³ ì„±ë°©ê°€)</div></div>
                    <div class="tab-btn" onclick="toggleTab('shipInfoArea', this)">ğŸš¢ ì„ ë°• ì •ë³´<div class="tab-sub">(ëˆ„êµ¬ë‚˜ ìˆ˜ì •)</div></div>
                    <div class="tab-btn" onclick="toggleTab('fileArea', this)">ğŸ’¾ ìë£Œì‹¤</div>
                    <div class="tab-btn" style="grid-column: span 2; border-color:#e74c3c; color:#e74c3c;" onclick="toggleTab('wageArea', this)">
                        ğŸ’° ì„ê¸ˆ ê³„ì‚°ê¸°
                        <div class="tab-sub" style="color:#e74c3c;">(ì‹¤ì‹œê°„ ê³„ì‚°)</div>
                    </div>
                </div>

                <div id="noticeArea" class="hidden">
                    <div class="form-box" style="border-left: 4px solid var(--danger);">
                        <h4 style="margin:0 0 10px 0; color:var(--danger);">ğŸ“¢ ì¤‘ìš” ê³µì§€ ì‘ì„± (ê´€ë¦¬ì)</h4>
                        <input type="text" id="noticeTitle" class="input-field" placeholder="ì œëª©">
                        <input type="text" id="noticeName" class="input-field" placeholder="ì‘ì„±ì">
                        <textarea id="noticeContent" class="input-field textarea-field" placeholder="ë‚´ìš©"></textarea>
                        <button class="action-btn bg-submit" onclick="addNotice()">ë“±ë¡í•˜ê¸°</button>
                    </div>
                    <ul id="noticeList" class="post-list"></ul>
                </div>

                <div id="boardArea" class="hidden">
                    <button class="action-btn" style="background:var(--secondary); margin-bottom:10px;" onclick="toggleHidden('boardForm')">âœï¸ ê¸€ì“°ê¸° ì—´ê¸°/ë‹«ê¸°</button>
                    <div id="boardForm" class="form-box hidden">
                        <select id="inputCategory" class="input-field">
                            <option value="ì¡ë‹´">ğŸ’¬ ì¡ë‹´</option>
                            <option value="ì •ë³´">â„¹ï¸ ì •ë³´ê³µìœ </option>
                            <option value="ì§ˆë¬¸">â“ ì§ˆë¬¸</option>
                            <option value="ê±´ì˜">ğŸ’¡ ê±´ì˜ì‚¬í•­</option>
                        </select>
                        <input type="text" id="inputTitle" class="input-field" placeholder="ì œëª©">
                        <div style="display:flex; gap:5px;">
                            <input type="text" id="inputName" class="input-field" placeholder="ì‘ì„±ì">
                            <input type="password" id="inputPw" class="input-field" placeholder="ë¹„ë²ˆ(ì‚­ì œìš©)">
                        </div>
                        <textarea id="inputContent" class="input-field textarea-field" placeholder="ë‚´ìš©"></textarea>
                        <button class="action-btn bg-submit" onclick="addPost()">ê²Œì‹œê¸€ ë“±ë¡</button>
                    </div>
                    <ul id="boardList" class="post-list"></ul>
                    <div id="pagination" class="pagination"></div>
                </div>

                <div id="shipInfoArea" class="hidden">
                    <button class="action-btn" style="background:var(--accent); margin-bottom:10px;" onclick="toggleHidden('shipForm')">ğŸš¢ ì„ ë°• ì •ë³´ ë“±ë¡/ìˆ˜ì •</button>
                    <a href="https://www.marinetraffic.com/" target="_blank" class="action-btn" style="background:#2980b9; text-align:center; display:block; text-decoration:none; font-size:0.9rem; margin-bottom:10px;">ğŸŒ ì„ ë°• ìœ„ì¹˜ ê²€ìƒ‰ (MarineTraffic)</a>
                    <div id="shipForm" class="form-box hidden">
                        <h4 style="margin:0 0 10px 0; color:var(--primary);">ğŸ“ ì •ë³´ ì…ë ¥</h4>
                        <input type="text" id="shipName" class="input-field" placeholder="ì„ ë°• ì´ë¦„ (í•„ìˆ˜)">
                        <label for="shipFileInput" class="file-label">ğŸ“¸ ì‚¬ì§„ ì²¨ë¶€ (ì„ íƒ)</label>
                        <input type="file" id="shipFileInput" accept="image/*" class="hidden" onchange="previewImage(this)">
                        <div id="previewBox" class="preview-box"><img id="imgPreview"></div>
                        <div class="tag-cloud">
                            <span class="tag-chip" onclick="addTag('ë¼ì‹±ë°”')">+ ë¼ì‹±ë°”</span>
                            <span class="tag-chip" onclick="addTag('í„´ë²„í´')">+ í„´ë²„í´</span>
                            <span class="tag-chip" onclick="addTag('ì•ˆì „ì œì¼')">+ ì•ˆì „ì œì¼</span>
                        </div>
                        <textarea id="shipOnboard" class="input-field textarea-field" placeholder="ë³¸ì„  ì‘ì—… íŠ¹ì§•"></textarea>
                        <textarea id="shipOnshore" class="input-field textarea-field" placeholder="ìœ¡ìƒ ì‘ì—… íŠ¹ì§•"></textarea>
                        <button id="shipSubmitBtn" class="action-btn bg-submit" onclick="addShipInfo()">ë“±ë¡í•˜ê¸°</button>
                        <button id="shipCancelBtn" class="action-btn bg-cancel hidden" onclick="resetShipForm()">ì·¨ì†Œ</button>
                        <div id="shipLoading" class="hidden" style="text-align:center; color:blue; margin-top:5px;">ì—…ë¡œë“œ ì¤‘...</div>
                    </div>
                    <ul id="shipList" class="post-list"></ul>
                    <div id="shipPagination" class="pagination"></div>
                </div>

                <div id="fileArea" class="hidden">
                    <input type="text" id="fileSearch" class="input-field" placeholder="ğŸ” ìë£Œ ê²€ìƒ‰..." onkeyup="filterFiles()">
                    <div class="form-box">
                        <input type="text" id="fileTitle" class="input-field" placeholder="ìë£Œ ì œëª©">
                        <input type="text" id="fileUploader" class="input-field" placeholder="ì˜¬ë¦°ì´">
                        <input type="file" id="fileInput" class="input-field">
                        <button class="action-btn bg-submit" onclick="uploadFile()">ìë£Œ ì—…ë¡œë“œ</button>
                        <div id="fileLoading" class="hidden" style="color:blue;">ì—…ë¡œë“œ ì¤‘...</div>
                    </div>
                    <ul id="fileList" class="post-list"></ul>
                    <div id="filePagination" class="pagination"></div>
                </div>

                <div id="wageArea" class="hidden">
                    <div class="form-box" style="border: 2px solid #e74c3c;">
                        <h4 style="margin:0 0 15px 0; color:#e74c3c; text-align:center; border-bottom:1px dashed #e74c3c; padding-bottom:10px;">ğŸ’° í˜„ì¥ ë§ì¶¤ ì›”ê¸‰ ê³„ì‚°ê¸°</h4>
                        <span class="wage-label">1. ê¸°ë³¸ ì •ë³´</span>
                        <div class="wage-row"><label>ì‹œê¸‰</label><input type="number" id="wageHourly" class="input-field" placeholder="10030" value="10030"><span class="wage-unit">ì›</span></div>
                        <span class="wage-label">2. ê·¼ë¬´ ì‹œê°„ (ì›” í•©ê³„)</span>
                        <div class="wage-row"><label>â˜€ï¸ ì£¼ê°„</label><input type="number" id="wageDayHours" class="input-field" placeholder="ì‹œê°„"><span class="wage-unit">H</span></div>
                        <div class="wage-row"><label>ğŸŒ™ ì•¼ê°„(1.5ë°°)</label><input type="number" id="wageNightHours" class="input-field" placeholder="ì‹œê°„"><span class="wage-unit">H</span></div>
                        <span class="wage-label">3. í˜„ì¥ ìˆ˜ë‹¹ (í•©ê³„ ê¸ˆì•¡)</span>
                        <div class="wage-row"><label>ğŸ”§ ê¸°ëŠ¥ê³µìˆ˜ë‹¹</label><input type="number" id="wageSkill" class="input-field" placeholder="ê¸ˆì•¡"><span class="wage-unit">ì›</span></div>
                        <div class="wage-row"><label>ğŸ—ï¸ ì ˆë§ì´</label><input type="number" id="wageSignal" class="input-field" placeholder="ê¸ˆì•¡"><span class="wage-unit">ì›</span></div>
                        <div class="wage-row"><label>â˜” ìš°ì²œìˆ˜ë‹¹</label><input type="number" id="wageRain" class="input-field" placeholder="ê¸ˆì•¡"><span class="wage-unit">ì›</span></div>
                        <span class="wage-label">4. ì„¸ê¸ˆ/ê³µì œ</span>
                        <select id="wageTaxType" class="input-field">
                            <option value="0">ê³µì œ ì—†ìŒ (0%)</option>
                            <option value="0.033">í”„ë¦¬ëœì„œ (3.3%)</option>
                            <option value="0.094">4ëŒ€ë³´í—˜ ì•½ì‹ (ì•½ 9.4%)</option>
                        </select>
                        <button class="action-btn bg-calc" style="margin-top:15px;" onclick="calculateWage()">ğŸ§® ê³„ì‚°í•˜ê¸°</button>
                        <div id="wageResultBox" class="wage-result-box hidden">
                            <div style="font-size:0.9rem; color:#666;">ì˜ˆìƒ ì›”ê¸‰ (ì„¸í›„)</div>
                            <div id="wageTotal" class="wage-total">0ì›</div>
                            <div style="font-size:0.75rem; color:#999; margin-top:5px;">* ì‹¤ì œ ì§€ê¸‰ì•¡ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="section-header" onclick="toggleSection('t3-content', this)">
                <span class="section-title">ğŸ­ 3í•­ì—… (ì‹ í•­ ë‚¨ì¸¡)</span>
                <span class="toggle-icon">â–¼</span>
            </div>
            <div id="t3-content" class="collapsible-content"> <div class="terminal-block">
                    <h4 class="terminal-title">í•œì§„ì‹ í•­ë§Œ (HJNC)</h4>
                    <div class="terminal-actions">
                        <a href="https://www.hjnc.co.kr/esvc/vessel/berthScheduleT" target="_blank" class="terminal-btn">ğŸ“… ìŠ¤ì¼€ì¤„</a>
                        <a href="https://www.hjnc.co.kr/esvc/vessel/berthScheduleG" target="_blank" class="terminal-btn">ğŸ“Š ì°¨íŠ¸</a>
                        <a href="https://www.hjnc.co.kr/esvc/vessel/vesselStatus" target="_blank" class="terminal-btn">ğŸ—ï¸ í˜„í™©</a>
                    </div>
                </div>
                <div class="terminal-block">
                    <h4 class="terminal-title">ë™ì›ë¡œì—‘ìŠ¤ (DGT)</h4>
                    <div class="terminal-actions">
                        <a href="https://www.dgtbusan.com/DGT/esvc/vessel/berthScheduleT" target="_blank" class="terminal-btn">ğŸ“… ìŠ¤ì¼€ì¤„</a>
                        <a href="https://www.dgtbusan.com/DGT/esvc/vessel/berthScheduleG" target="_blank" class="terminal-btn">ğŸ“Š ì°¨íŠ¸</a>
                        <a href="https://www.dgtbusan.com/DGT/esvc/vessel/vesselStatus" target="_blank" class="terminal-btn">ğŸ—ï¸ í˜„í™©</a>
                    </div>
                </div>
                <div class="terminal-block">
                    <h4 class="terminal-title">ë¶€ì‚°ì‹ í•­ì»¨í…Œì´ë„ˆ (BNCT/ê³ ë ¤)</h4>
                    <div class="terminal-actions">
                        <a href="https://info.bnctkorea.com/esvc/vessel/berthScheduleT" target="_blank" class="terminal-btn">ğŸ“… ìŠ¤ì¼€ì¤„</a>
                        <a href="https://info.bnctkorea.com/esvc/vessel/berthScheduleG" target="_blank" class="terminal-btn">ğŸ“Š ì°¨íŠ¸</a>
                        <a href="https://info.bnctkorea.com/esvc/vessel/vesselStatus" target="_blank" class="terminal-btn">ğŸ—ï¸ í˜„í™©</a>
                    </div>
                </div>
                <div class="terminal-block">
                    <h4 class="terminal-title">ë¶€ì‚°ì»¨í…Œì´ë„ˆí„°ë¯¸ë„ (BCT)</h4>
                    <div class="terminal-actions">
                        <a href="https://info.bct2-4.com/infoservice/index.html" target="_blank" class="terminal-btn">ğŸ“… ìŠ¤ì¼€ì¤„</a>
                        <a href="https://info.bct2-4.com/infoservice/index.html" target="_blank" class="terminal-btn">ğŸ“Š ì°¨íŠ¸</a>
                        <a href="https://info.bct2-4.com/infoservice/index.html" target="_blank" class="terminal-btn">ğŸ—ï¸ í˜„í™©</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="section-header" onclick="toggleSection('t2-content', this)">
                <span class="section-title">ğŸ­ 2í•­ì—… (ì‹ í•­ ë¶ì¸¡)</span>
                <span class="toggle-icon rotated">â–¼</span>
            </div>
            <div id="t2-content" class="collapsible-content collapsed">
                <div class="terminal-block">
                    <h4 class="terminal-title">ë¶€ì‚°ì‹ í•­ë§Œ (PNC)</h4>
                    <div class="terminal-actions">
                        <a href="https://svc.pncport.com/info/CMS/Ship/Info.pnc?mCode=MN014" target="_blank" class="terminal-btn">ğŸ“… ìŠ¤ì¼€ì¤„</a>
                        <a href="https://svc.pncport.com/info/CMS/Ship/ShipBerthC.pnc?mCode=MN019" target="_blank" class="terminal-btn">ğŸ“Š ì°¨íŠ¸</a>
                        <a href="https://svc.pncport.com/info/CMS/Ship/ShipVslStatus.pnc?mCode=MN020" target="_blank" class="terminal-btn">ğŸ—ï¸ í˜„í™©</a>
                    </div>
                    <button class="action-btn" style="background:#f39c12; margin-top:10px; font-size:0.9rem; padding:10px;" onclick="openBusSchedule()">ğŸšŒ PNC ì…”í‹€ë²„ìŠ¤ ì‹œê°„í‘œ</button>
                </div>
                <div class="terminal-block">
                    <h4 class="terminal-title">ì‹ í•­êµ­ì œ (PNIT)</h4>
                    <div class="terminal-actions">
                        <a href="https://www.pnitl.com/infoservice/vessel/vslScheduleList.jsp" target="_blank" class="terminal-btn">ğŸ“… ìŠ¤ì¼€ì¤„</a>
                        <a href="https://www.pnitl.com/infoservice/vessel/vslScheduleChart.jsp" target="_blank" class="terminal-btn">ğŸ“Š ì°¨íŠ¸</a>
                        <a href="https://www.pnitl.com/infoservice/vessel/vslWorkStatus.jsp" target="_blank" class="terminal-btn">ğŸ—ï¸ í˜„í™©</a>
                    </div>
                </div>
                <div class="terminal-block">
                    <h4 class="terminal-title">í˜„ëŒ€ë¶€ì‚°ì‹ í•­ë§Œ (HPNT)</h4>
                    <div class="terminal-actions">
                        <a href="https://www.hpnt.co.kr/infoservice/vessel/vslScheduleList.jsp" target="_blank" class="terminal-btn">ğŸ“… ìŠ¤ì¼€ì¤„</a>
                        <a href="https://www.hpnt.co.kr/infoservice/vessel/vslScheduleChart.jsp" target="_blank" class="terminal-btn">ğŸ“Š ì°¨íŠ¸</a>
                        <a href="https://www.hpnt.co.kr/infoservice/vessel/vslWorkStatus.jsp" target="_blank" class="terminal-btn">ğŸ—ï¸ í˜„í™©</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="section-header" onclick="toggleSection('t1-content', this)">
                <span class="section-title">ğŸ­ 1í•­ì—… (ë¶í•­)</span>
                <span class="toggle-icon rotated">â–¼</span>
            </div>
            <div id="t1-content" class="collapsible-content collapsed">
                 <div class="terminal-block">
                    <h4 class="terminal-title">ë¶í•­ í†µí•© (BPTC)</h4>
                    <div class="terminal-actions">
                        <a href="http://info.bptc.co.kr:9084/content/sw/frame/berth_status_text_frame_sw_kr.jsp?p_id=BETX_SH_KR&snb_num=2&snb_div=service" target="_blank" class="terminal-btn" style="grid-column: span 3;">ğŸ—ï¸ ê°ë§Œ / ì‹ ì„ ëŒ€ ì„ ì„ ì •ë³´</a>
                    </div>
                </div>
                 <div class="terminal-block">
                    <h4 class="terminal-title">í—ˆì¹˜ìŠ¨ (HBCT)</h4>
                    <div class="terminal-actions">
                         <a href="https://custom.hktl.com/jsp/T01/sunsuk.jsp" target="_blank" class="terminal-btn" style="grid-column: span 3;">âš“ ì„ ì„ ì •ë³´ ë°”ë¡œê°€ê¸°</a>
                    </div>
                </div>
                 <div class="terminal-block">
                    <h4 class="terminal-title">ë™ë¶€ (DPCT)</h4>
                    <div class="terminal-actions">
                        <a href="http://info.bptc.co.kr:9084/content/index.jsp#03" target="_blank" class="terminal-btn" style="grid-column: span 3;">ğŸš¢ í„°ë¯¸ë„ ì •ë³´ í¬í„¸</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="section-header" onclick="toggleSection('control-content', this)">
                <span class="section-title">ğŸ“¡ ê´€ì œ ë° ë‚ ì”¨</span>
                <span class="toggle-icon rotated">â–¼</span>
            </div>
            <div id="control-content" class="collapsible-content collapsed">
                <div class="dashboard-grid">
                    <a href="http://www.busanpilot.co.kr/popup/monitoring" class="dash-btn" target="_blank"><span>ğŸ›¥ï¸</span>ë„ì„ <br>ëª¨ë‹ˆí„°</a>
                    <a href="https://new.portmis.go.kr/" class="dash-btn" target="_blank"><span>ğŸ“‘</span>PORT<br>MIS</a>
                    <a href="https://weather.naver.com/today/08440585" class="dash-btn" target="_blank" style="color:#e74c3c;"><span>â˜€ï¸</span>ë¶€ì‚°<br>ë‚ ì”¨</a>
                </div>
            </div>
        </div>

        <div class="card" style="padding:10px; text-align:center;">
            <div style="font-size:0.8rem; color:#aaa; margin-bottom:5px;">(ê´‘ê³ ) ì„œë²„ ìš´ì˜ë¹„ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.</div>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-1060846766"
                 data-ad-slot="1234567890"  
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item" onclick="scrollToTop()"><span class="nav-icon">ğŸ </span>í™ˆ</div>
        <div class="nav-item" onclick="activateTab('boardArea')"><span class="nav-icon">ğŸ’¬</span>ê²Œì‹œíŒ</div>
        <div class="nav-item" onclick="activateTab('shipInfoArea')"><span class="nav-icon">ğŸš¢</span>ì„ ë°•ì •ë³´</div>
        <div class="nav-item" onclick="activateTab('fileArea')"><span class="nav-icon">ğŸ’¾</span>ìë£Œì‹¤</div>
    </nav>

    <div id="toast">ì•Œë¦¼ ë©”ì‹œì§€</div>

    <div id="imageModal" class="modal-overlay" onclick="closeImageModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <img id="modalImage" class="modal-img">
            <button class="action-btn bg-cancel" onclick="closeImageModal()">ë‹«ê¸°</button>
        </div>
    </div>

    <div id="bannerAdminModal" class="modal-overlay">
        <div class="modal-content">
            <h3>ğŸš¨ ì•ˆì „ ë°°ë„ˆ ê´€ë¦¬</h3>
            <ul id="adminBannerList" class="admin-list" style="text-align:left; padding:0; list-style:none;"></ul>
            <button class="action-btn bg-danger" style="background:var(--danger); margin-top:10px;" onclick="resetBannerMsg()">ì „ì²´ ì´ˆê¸°í™”</button>
            <button class="action-btn bg-cancel" onclick="document.getElementById('bannerAdminModal').style.display='none'">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        // --- Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyBDXy5HcYW-IZQJ9ZDEivr_yi99AxhYme8",
            authDomain: "my-app-d8527.firebaseapp.com",
            projectId: "my-app-d8527",
            storageBucket: "my-app-d8527.firebasestorage.app",
            messagingSenderId: "667323279185",
            appId: "1:667323279185:web:cff6184aaa82e08d345570",
            measurementId: "G-HZQLF0L77P"
        };

        let db, storage;
        let allPostsData=[], allShipsData=[], allFilesData=[];
        let currentBoardPage=1, currentShipPage=1, currentFilePage=1;
        const postsPerPage=5;
        let editingShipId = null;
        let currentBannerMsgs = [];

        try {
            if (firebase.apps.length === 0) firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            storage = firebase.storage();
            loadPostsRealtime(); loadFilesRealtime(); loadNoticesRealtime(); loadShipsRealtime(); loadBanner();
            if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
        } catch(e) { console.error(e); }

        // --- UI Utils ---
        function showToast(msg) {
            const t = document.getElementById("toast");
            t.innerText = msg; t.className = "show";
            setTimeout(() => { t.className = t.className.replace("show", ""); }, 3000);
        }
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
            showToast(document.body.classList.contains('dark-mode') ? "ë‹¤í¬ ëª¨ë“œ ON" : "ë¼ì´íŠ¸ ëª¨ë“œ ON");
        }
        function scrollToTop() { window.scrollTo({top:0, behavior:'smooth'}); }
        function toggleHidden(id) { document.getElementById(id).classList.toggle('hidden'); }
        
        // [NEW] Section Toggle Function
        function toggleSection(contentId, headerEl) {
            const content = document.getElementById(contentId);
            const icon = headerEl.querySelector('.toggle-icon');
            
            content.classList.toggle('collapsed');
            icon.classList.toggle('rotated');
        }

        function activateTab(targetId) {
            document.getElementById('section-community').scrollIntoView({behavior:'smooth'});
            // ì»¤ë®¤ë‹ˆí‹° ì„¹ì…˜ì´ ì ‘í˜€ìˆë‹¤ë©´ í¼ì¹˜ê¸°
            const commContent = document.getElementById('comm-content');
            const commIcon = document.querySelector('#section-community .toggle-icon');
            if(commContent.classList.contains('collapsed')) {
                commContent.classList.remove('collapsed');
                commIcon.classList.remove('rotated');
            }

            document.querySelectorAll('.tab-btn').forEach(btn => {
                if(btn.onclick && btn.onclick.toString().includes(targetId)) btn.click();
            });
        }

        function toggleTab(areaId, btn) {
            const allAreas = ['noticeArea', 'boardArea', 'shipInfoArea', 'fileArea', 'wageArea'];
            const target = document.getElementById(areaId);
            const isVisible = !target.classList.contains('hidden');

            allAreas.forEach(id => document.getElementById(id).classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));

            if (!isVisible) {
                target.classList.remove('hidden');
                btn.classList.add('active');
            }
        }

        // Wage Logic
        function calculateWage() {
            const hourly = parseFloat(document.getElementById('wageHourly').value) || 0;
            const dayHours = parseFloat(document.getElementById('wageDayHours').value) || 0;
            const nightHours = parseFloat(document.getElementById('wageNightHours').value) || 0;
            
            const skillPay = parseFloat(document.getElementById('wageSkill').value) || 0;
            const signalPay = parseFloat(document.getElementById('wageSignal').value) || 0;
            const rainPay = parseFloat(document.getElementById('wageRain').value) || 0;
            
            const taxRate = parseFloat(document.getElementById('wageTaxType').value);

            // Calculation
            const basePay = hourly * dayHours;
            const nightPay = hourly * 1.5 * nightHours;
            
            const grossPay = basePay + nightPay + skillPay + signalPay + rainPay;
            const tax = grossPay * taxRate;
            const netPay = grossPay - tax;

            // Display
            document.getElementById('wageResultBox').classList.remove('hidden');
            document.getElementById('wageTotal').innerText = Math.floor(netPay).toLocaleString() + "ì›";
            
            // Scroll to result
            document.getElementById('wageResultBox').scrollIntoView({behavior:'smooth'});
        }

        // --- Ship Info ---
        function resetShipForm() {
            editingShipId = null;
            document.getElementById('shipName').value = '';
            document.getElementById('shipOnboard').value = '';
            document.getElementById('shipOnshore').value = '';
            document.getElementById('shipFileInput').value = '';
            document.getElementById('previewBox').style.display = 'none';
            document.getElementById('shipSubmitBtn').innerText = "ë“±ë¡í•˜ê¸°";
            document.getElementById('shipCancelBtn').classList.add('hidden');
            document.getElementById('shipForm').classList.add('hidden');
        }
        function previewImage(input) {
            if(input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imgPreview').src = e.target.result;
                    document.getElementById('previewBox').style.display = 'block';
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
        function addTag(tag) {
            const area = document.getElementById('shipOnboard');
            area.value += (area.value ? ", " : "") + tag;
        }
        function editShip(id) {
            const ship = allShipsData.find(s => s.id === id);
            if (!ship) return;
            editingShipId = id;
            document.getElementById('shipName').value = ship.shipName;
            document.getElementById('shipOnboard').value = ship.onboardFeat;
            document.getElementById('shipOnshore').value = ship.onshoreFeat;
            document.getElementById('shipForm').classList.remove('hidden');
            document.getElementById('shipSubmitBtn').innerText = "ìˆ˜ì • ì™„ë£Œ";
            document.getElementById('shipCancelBtn').classList.remove('hidden');
            document.getElementById('shipForm').scrollIntoView({behavior:'smooth'});
        }
        function addShipInfo() {
            const name = document.getElementById('shipName').value.trim();
            const onboard = document.getElementById('shipOnboard').value;
            const onshore = document.getElementById('shipOnshore').value;
            const file = document.getElementById('shipFileInput').files[0];
            if (!name) { showToast("âš ï¸ ì„ ë°• ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”."); return; }
            if (!editingShipId) {
                db.collection("ships").where("shipName", "==", name).get().then(qs => {
                    if (!qs.empty) { showToast("âš ï¸ ì´ë¯¸ ë“±ë¡ëœ ì„ ë°•ì…ë‹ˆë‹¤."); return; }
                    processShipSave(name, onboard, onshore, file);
                });
            } else { processShipSave(name, onboard, onshore, file); }
        }
        function processShipSave(name, onboard, onshore, file) {
            document.getElementById('shipLoading').classList.remove('hidden');
            if (file) {
                const ref = storage.ref('ships/' + Date.now() + '_' + file.name);
                ref.put(file).then(s => s.ref.getDownloadURL()).then(url => {
                    saveShipToDb(name, onboard, onshore, url);
                });
            } else {
                if (editingShipId) {
                    const origin = allShipsData.find(s => s.id === editingShipId);
                    saveShipToDb(name, onboard, onshore, origin.imageUrl);
                } else { saveShipToDb(name, onboard, onshore, null); }
            }
        }
        function saveShipToDb(name, onboard, onshore, url) {
            const data = { shipName: name, onboardFeat: onboard, onshoreFeat: onshore, imageUrl: url, date: new Date().toLocaleString(), timestamp: firebase.firestore.FieldValue.serverTimestamp() };
            const promise = editingShipId ? db.collection("ships").doc(editingShipId).update(data) : db.collection("ships").add(data);
            promise.then(() => {
                document.getElementById('shipLoading').classList.add('hidden');
                showToast(editingShipId ? "âœ… ìˆ˜ì • ì™„ë£Œ!" : "âœ… ë“±ë¡ ì™„ë£Œ!");
                resetShipForm();
            });
        }
        function deleteShip(id, event) {
            event.stopPropagation();
            const pw = prompt("ê´€ë¦¬ì ì•”í˜¸(ì‚­ì œ ê¶Œí•œ):");
            if (pw === "0346") {
                if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) db.collection("ships").doc(id).delete().then(() => showToast("ğŸ—‘ï¸ ì‚­ì œë¨"));
            } else { showToast("â›” ì•”í˜¸ ì˜¤ë¥˜"); }
        }
        function renderShipPage(page) {
            currentShipPage = page;
            const list = document.getElementById("shipList"); list.innerHTML = "";
            const start = (page-1)*postsPerPage;
            const items = allShipsData.slice(start, start+postsPerPage);
            if(items.length===0) list.innerHTML = "<li style='padding:20px;text-align:center;'>ë“±ë¡ëœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</li>";
            items.forEach(s => {
                let imgBtn = s.imageUrl ? `<button class="mini-btn btn-photo" onclick="event.stopPropagation();showImageModal('${s.imageUrl}')">ğŸ“· ì‚¬ì§„</button>` : "";
                const li = document.createElement("li");
                li.className = "post-item";
                li.innerHTML = `<div class="post-header" onclick="toggleHidden('ship-body-${s.id}')"><span class="post-title">ğŸš¢ ${s.shipName}</span><div class="post-actions">${imgBtn}<button class="mini-btn btn-edit" onclick="event.stopPropagation();editShip('${s.id}')">ìˆ˜ì •</button><button class="mini-btn btn-del" onclick="deleteShip('${s.id}', event)">ì‚­ì œ</button></div></div><div id="ship-body-${s.id}" class="post-body"><p><strong>[ë³¸ì„ ]</strong> ${s.onboardFeat || '-'}</p><p><strong>[ìœ¡ìƒ]</strong> ${s.onshoreFeat || '-'}</p></div>`;
                list.appendChild(li);
            });
            renderPagination("shipPagination", Math.ceil(allShipsData.length/postsPerPage), currentShipPage, renderShipPage);
        }
        function loadShipsRealtime() {
            db.collection("ships").orderBy("shipName", "asc").onSnapshot(s => {
                allShipsData = []; s.forEach(d => { let obj=d.data(); obj.id=d.id; allShipsData.push(obj); });
                renderShipPage(1);
            });
        }

        // --- Standard Logic ---
        function loadBanner() {
            db.collection('settings').doc('banner').onSnapshot(d => {
                if(d.exists && d.data().messages?.length) {
                    document.getElementById('safetyTicker').classList.remove('hidden');
                    document.getElementById('tickerText').innerText = "ğŸš¨ " + d.data().messages.join("   /   ");
                } else { document.getElementById('safetyTicker').classList.add('hidden'); }
            });
        }
        function updateBanner() {
            const txt = prompt("ì•ˆì „ ê³µì§€ ì…ë ¥ (ìƒˆ ê¸€ì€ 1ë²ˆìœ¼ë¡œ):");
            if(txt) {
                db.collection('settings').doc('banner').get().then(d => {
                    let msgs = d.exists ? (d.data().messages || []) : [];
                    msgs.unshift(txt); if(msgs.length>5) msgs = msgs.slice(0,5);
                    db.collection('settings').doc('banner').set({messages: msgs});
                });
            }
        }
        function openBannerAdmin() {
            if(prompt("ê´€ë¦¬ì ì•”í˜¸:")==="0346") {
                document.getElementById('bannerAdminModal').style.display='flex';
                const ul = document.getElementById('adminBannerList'); ul.innerHTML="";
                currentBannerMsgs.forEach((m,i) => {
                    ul.innerHTML += `<li style="display:flex;justify-content:space-between;padding:5px;border-bottom:1px solid #eee;"><span>${m}</span><button class="mini-btn btn-del" onclick="delBanner(${i})">ì‚­ì œ</button></li>`;
                });
            }
        }
        function deleteBannerMsg(index) {
            if(!confirm("ì‚­ì œ?")) return;
            db.collection('settings').doc('banner').get().then(d => {
                let msgs = d.data().messages; msgs.splice(index,1);
                db.collection('settings').doc('banner').set({messages:msgs}).then(()=>document.getElementById('bannerAdminModal').style.display='none');
            });
        }
        function resetBannerMsg() {
            if(confirm("ì „ì²´ ì‚­ì œ?")) db.collection('settings').doc('banner').set({messages:[]}).then(()=>document.getElementById('bannerAdminModal').style.display='none');
        }

        function addPost() {
            const cat = document.getElementById('inputCategory').value;
            const title = document.getElementById('inputTitle').value;
            const name = document.getElementById('inputName').value;
            const pw = document.getElementById('inputPw').value;
            const content = document.getElementById('inputContent').value;
            if(!title || !name || !pw) { showToast("âš ï¸ í•„ìˆ˜ ì…ë ¥ ëˆ„ë½"); return; }
            db.collection("posts").add({ category:cat, title:title, name:name, password:pw, content:content, date:new Date().toLocaleString(), timestamp: firebase.firestore.FieldValue.serverTimestamp(), comments:[] })
            .then(() => { showToast("âœ… ë“±ë¡ë¨"); toggleHidden('boardForm'); });
        }
        function loadPostsRealtime() {
            db.collection("posts").orderBy("timestamp", "desc").onSnapshot(s => {
                allPostsData=[]; s.forEach(d=>{let o=d.data(); o.id=d.id; allPostsData.push(o)}); renderBoardPage(1);
            });
        }
        function renderBoardPage(page) {
            currentBoardPage=page; const list=document.getElementById("boardList"); list.innerHTML="";
            const items = allPostsData.slice((page-1)*postsPerPage, page*postsPerPage);
            items.forEach(p => {
                const li = document.createElement("li"); li.className="post-item";
                li.innerHTML = `<div class="post-header" onclick="toggleHidden('post-${p.id}')"><div class="post-main"><span style="color:var(--accent);font-size:0.8rem;">[${p.category}]</span> <span class="post-title" style="display:inline;">${p.title}</span><div class="post-meta">${p.name} | ${p.date.split(' ')[0]}</div></div><button class="mini-btn btn-del" onclick="deletePost('${p.id}', '${p.password}', event)">ì‚­ì œ</button></div><div id="post-${p.id}" class="post-body">${p.content}</div>`;
                list.appendChild(li);
            });
            renderPagination("pagination", Math.ceil(allPostsData.length/postsPerPage), currentBoardPage, renderBoardPage);
        }
        function deletePost(id, realPw, e) {
            e.stopPropagation(); const inPw = prompt("ë¹„ë°€ë²ˆí˜¸:");
            if(inPw===realPw || inPw==="0346") db.collection("posts").doc(id).delete().then(()=>showToast("ğŸ—‘ï¸ ì‚­ì œë¨")); else showToast("â›” ì˜¤ë¥˜");
        }

        function addNotice() {
            if(prompt("ê´€ë¦¬ì ì•”í˜¸:")!=="0346") return;
            const t=document.getElementById('noticeTitle').value, c=document.getElementById('noticeContent').value;
            db.collection("notices").add({title:t, name:"ê´€ë¦¬ì", content:c, date:new Date().toLocaleString(), timestamp: firebase.firestore.FieldValue.serverTimestamp()}).then(()=>showToast("ê³µì§€ ë“±ë¡ë¨"));
        }
        function loadNoticesRealtime() {
            db.collection("notices").orderBy("timestamp", "desc").onSnapshot(s => {
                const l=document.getElementById("noticeList"); l.innerHTML="";
                s.forEach(d => {
                    const n=d.data();
                    l.innerHTML += `<li class="post-item"><div class="post-header" onclick="toggleHidden('n-${d.id}')"><span class="post-title" style="color:var(--danger)">ğŸ“¢ ${n.title}</span><div class="post-meta">${n.date.split(' ')[0]}</div><button class="mini-btn btn-del" onclick="delNotice('${d.id}', event)">ì‚­ì œ</button></div><div id="n-${d.id}" class="post-body">${n.content}</div></li>`;
                });
            });
        }
        function delNotice(id, e) { e.stopPropagation(); if(prompt("ì•”í˜¸:")==="0346") db.collection("notices").doc(id).delete(); }

        function uploadFile() {
            const f=document.getElementById('fileInput').files[0];
            const t=document.getElementById('fileTitle').value;
            if(!f || !t) return;
            document.getElementById('fileLoading').classList.remove('hidden');
            storage.ref('archives/'+Date.now()+'_'+f.name).put(f).then(s=>s.ref.getDownloadURL()).then(u=>{
                db.collection("archives").add({title:t, uploader:document.getElementById('fileUploader').value, fileUrl:u, date:new Date().toLocaleString(), timestamp: firebase.firestore.FieldValue.serverTimestamp()});
                document.getElementById('fileLoading').classList.add('hidden'); showToast("íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ");
            });
        }
        function loadFilesRealtime() {
            db.collection("archives").orderBy("timestamp", "desc").onSnapshot(s => {
                allFilesData=[]; s.forEach(d=>{let o=d.data(); o.id=d.id; allFilesData.push(o)}); renderFilePage(1);
            });
        }
        function renderFilePage(p) {
            currentFilePage=p; const l=document.getElementById("fileList"); l.innerHTML="";
            const items=allFilesData.slice((p-1)*postsPerPage, p*postsPerPage);
            items.forEach(f => {
                l.innerHTML += `<li class="post-item" style="display:flex;justify-content:space-between;align-items:center;"><div><a href="${f.fileUrl}" target="_blank" style="text-decoration:none;color:var(--text);font-weight:bold;">ğŸ’¾ ${f.title}</a><div class="post-meta">${f.uploader}</div></div><a href="${f.fileUrl}" download class="mini-btn btn-photo" style="text-decoration:none;">ë‹¤ìš´</a></li>`;
            });
            renderPagination("filePagination", Math.ceil(allFilesData.length/postsPerPage), currentFilePage, renderFilePage);
        }
        function filterFiles() {
            const k = document.getElementById('fileSearch').value.toUpperCase();
            const list = document.getElementById('fileList').getElementsByTagName('li');
            for(let i=0; i<list.length; i++) list[i].style.display = list[i].innerText.toUpperCase().includes(k) ? "" : "none";
        }

        function openBusSchedule() { showImageModal("https://firebasestorage.googleapis.com/v0/b/my-app-d8527.firebasestorage.app/o/archives%2F1769013796862_BandPhoto_2026_01_22_01_39_56.jpg?alt=media&token=a2e8f727-250a-41aa-855c-7b1f341d9048"); }
        function showImageModal(src) { document.getElementById("modalImage").src=src; document.getElementById("imageModal").style.display="flex"; }
        function closeImageModal() { document.getElementById("imageModal").style.display="none"; }
    </script>
</body>
</html>