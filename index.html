<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="description" content="ë¶€ì‚°í•­ í˜„ì¥ì§ í•„ìˆ˜ ì•±">
    <title>BUSAN HAK PORT INFO</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6024353303588422" crossorigin="anonymous"></script>
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="stylesheet" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />

    <style>
        :root { --primary: #1e3a8a; --primary-light: #3b82f6; --accent: #f59e0b; --bg-color: #f3f4f6; --card-bg: rgba(255, 255, 255, 0.98); --text-main: #1f2937; --text-sub: #6b7280; --border: rgba(229, 231, 235, 0.9); --danger: #ef4444; --success: #10b981; }
        body.dark-mode { --primary: #60a5fa; --primary-light: #93c5fd; --accent: #fbbf24; --bg-color: #0f172a; --card-bg: rgba(30, 41, 59, 0.98); --text-main: #f3f4f6; --text-sub: #9ca3af; --border: rgba(55, 65, 81, 0.7); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Pretendard', sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-main); margin: 0; padding: 0; padding-bottom: 90px; padding-top: env(safe-area-inset-top); font-size: 16px; }
        header { background: linear-gradient(135deg, var(--primary), var(--primary-light)); color: white; padding: 14px 0; text-align: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        header h1 { margin: 0; font-size: 1.2rem; font-weight: 900; }
        .theme-toggle { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.2); border: none; width: 34px; height: 34px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.1rem; }
        .container { width: 96%; max-width: 600px; margin: 0 auto; padding: 8px; }
        .dash-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px; }
        .dash-card { background: var(--card-bg); border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid var(--border); overflow: hidden; }
        .dash-card.expanded { grid-column: span 2; }
        .dash-header { padding: 14px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.05); min-height: 50px; }
        .dash-title { font-size: 1rem; font-weight: 800; color: var(--text-main); display: flex; align-items: center; gap: 6px; }
        .dash-content { display: none; padding: 12px; background: var(--card-bg); animation: fadeIn 0.2s; }
        .expanded .dash-content { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        /* ì…ë ¥í•„ë“œ ê³µí†µ */
        .input-field { width: 100%; padding: 0 10px; border: 1px solid var(--border); border-radius: 8px; background: rgba(255,255,255,0.6); color: var(--text-main); font-size: 1rem; height: 40px; text-align: right; font-weight: bold; }
        .action-btn { width: 100%; padding: 14px; border: none; border-radius: 10px; font-weight: 800; color: white; cursor: pointer; background: var(--primary); font-size: 1rem; margin-top: 5px; }
        .bg-calc { background: linear-gradient(135deg, #ef4444, #b91c1c); }
        .wage-row { display: flex; align-items: center; margin-bottom: 8px; width: 100%; justify-content: space-between; }
        .wage-row label { width: auto; min-width: 60px; font-weight: 700; font-size: 0.9rem; white-space: nowrap; text-align: left; margin-right: 5px; }
        .wage-result-box { background: linear-gradient(135deg, #ffffff, #f9fafb); border: 2px solid var(--primary); border-radius: 10px; padding: 15px; margin-top: 15px; }
        .wage-total { font-size: 1.5rem; color: #c2410c; font-weight: 900; text-align: center; border-top: 2px solid var(--primary); padding-top: 10px; margin-top: 10px; }
    </style>
</head>
<body>
    <header>
        <h1>BUSAN HAK PORT</h1>
        <button class="theme-toggle" onclick="toggleDarkMode()">ğŸŒ™</button>
    </header>

    <div id="safetyTicker" class="ticker-container" style="background: var(--accent); color: #000; font-weight: 800; height: 38px; display: flex; align-items: center; overflow: hidden; position: relative;">
        <div class="ticker-wrap" style="width: 100%;"><div id="tickerText" class="ticker-item" style="padding-left: 100%; animation: ticker 25s linear infinite; white-space: nowrap;">ğŸš¨ ì•ˆì „ ì œì¼! ì˜¤ëŠ˜ë„ ë¬´ì‚¬ê³ !</div></div>
        <div class="ticker-controls" style="position: absolute; right: 0; display: flex;">
            <button onclick="writeUserTicker()">ğŸ—£ï¸</button>
            <button onclick="updateBanner()">âœï¸</button> <button onclick="openTickerManager()">âš™ï¸</button>
        </div>
    </div>

    <div class="container">
        <div class="dash-grid">
            <div id="wage-card" class="dash-card expanded" style="border:1px solid var(--danger);">
                <div class="dash-header" onclick="toggleDashItem('wage-card')">
                    <span class="dash-title" style="color:var(--danger);">ğŸ’° ì„ê¸ˆê³„ì‚°ê¸°</span><span>â–¼</span>
                </div>
                <div class="dash-content">
                    <div class="wage-row"><label>ì‹œê¸‰(ê¸°ë³¸)</label><input type="number" id="wageHourly" class="input-field" value="10320" readonly></div>
                    <div class="wage-row"><label>â³ ì´ ê·¼ë¬´</label><input type="number" id="wageTotalHours" class="input-field" placeholder="H"></div>
                    <button class="action-btn bg-calc" onclick="calculateWage()">ê³„ì‚°í•˜ê¸°</button>
                    <div id="wageResultBox" class="hidden wage-result-box">
                        <div id="wageTotal" class="wage-total">0ì›</div>
                    </div>
                </div>
            </div>
            <div id="log-card" class="dash-card" style="border:1px solid var(--primary);">
                <div class="dash-header" onclick="toggleDashItem('log-card')">
                    <span class="dash-title" style="color:var(--primary);">ğŸ“… ìŠ¤ë§ˆíŠ¸ ê·¼ë¬´ì¼ì§€(ì§ì§€)</span><span class="toggle-icon">â–¼</span>
                </div>
                <div id="workLogArea" class="dash-content">
                    <div id="userProfileBar" class="user-auth-bar" style="display:none; justify-content: space-between; align-items: center; background: rgba(59, 130, 246, 0.1); padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                        <div class="user-info">
                            <span id="currentUserDisplay" class="user-name" style="font-weight: 800; color: var(--primary);"></span>
                            <span class="user-status" style="font-size: 0.75rem; color: var(--success);">ğŸ”’ ë‚´ ì €ì¥ì†Œ</span>
                        </div>
                        <button class="logout-btn" onclick="logoutWorker()" style="background: var(--text-sub); color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem;">ë¡œê·¸ì•„ì›ƒ</button>
                    </div>

                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                        <button class="mini-btn" style="padding:6px 12px; font-size:1rem;" onclick="changeMonth(-1)">â—€</button>
                        <span id="calMonthYear" style="font-weight:bold; font-size:1.1rem;"></span>
                        <button class="mini-btn" style="padding:6px 12px; font-size:1rem;" onclick="changeMonth(1)">â–¶</button>
                    </div>
                    
                    <div id="calendarGrid" class="calendar-grid"></div>
                    
                    <div id="dailyLogForm" class="hidden" style="margin-top:20px; padding:15px; background:rgba(0,0,0,0.03); border-radius:12px; border:1px solid var(--border);">
                        <h4 id="selectedDateText" style="margin:0 0 10px 0; color:var(--primary); text-align:center; font-size:1.1rem;"></h4>
                        <div class="wage-row"><label>ì£¼ê°„</label><input type="number" id="logDayHours" class="input-field" placeholder="ì‹œê°„(H)" step="0.5"></div>
                        <div class="wage-row"><label>ì•¼ê°„</label><input type="number" id="logNightHours" class="input-field" placeholder="ì‹œê°„(H)" step="0.5"></div>
                        <textarea id="logMemo" class="input-field textarea-field" placeholder="ì‘ì—… ë‚´ìš©..." style="height: 80px; resize: none; text-align: left;"></textarea>
                        <label style="font-size:0.85rem; font-weight:bold; display:block; margin-top:10px; margin-bottom:4px;">ğŸ“· í˜„ì¥ ì‚¬ì§„</label>
                        <input type="file" id="logImageInput" class="input-field" accept="image/*" onchange="previewLogImage(this)">
                        <img id="logImagePreview" style="max-width:100%; border-radius:8px; margin-top:8px; display:none;" onclick="document.getElementById('imageModal').style.display='flex'; document.getElementById('modalImage').src=this.src;">
                        <div style="display:flex; gap:10px; margin-top:15px;">
                            <button id="saveLogBtn" class="action-btn bg-submit" onclick="trySaveWorkLog()">ì €ì¥í•˜ê¸°</button>
                            <button class="action-btn bg-cancel" style="background:var(--danger);" onclick="deleteWorkLog()">ì‚­ì œ</button>
                        </div>
                    </div>
                    <div id="monthlyTotalDisplay" style="text-align:center; margin-top:20px; font-weight:bold; color:var(--primary); font-size:1.2rem; border-top:1px dashed var(--border); padding-top:15px;">ì´ë²ˆë‹¬ ì´ì•¡: 0ì›</div>
                </div>
            </div>
        </div>

        <div class="card" style="border-left: 5px solid #3b82f6;">
            <div class="section-header" onclick="toggleSection('t3-content', this)"><span class="section-title">â›´ï¸ 3í•­ì—… (ì‹ í•­ ë‚¨ì¸¡) â–¼</span></div>
            <div id="t3-content" class="collapsible-content collapsed">
                <div class="terminal-block"><div class="terminal-header" onclick="toggleContent('term-hjnc')">í•œì§„ì‹ í•­ë§Œ (HJNC) â–¼</div><div id="term-hjnc" class="terminal-body"><div class="terminal-actions"><a href="https://www.hjnc.co.kr/esvc/vessel/berthScheduleT" target="_blank" class="terminal-btn">ìŠ¤ì¼€ì¤„</a><a href="https://www.hjnc.co.kr/esvc/vessel/berthScheduleG" target="_blank" class="terminal-btn">ì°¨íŠ¸</a><a href="https://www.hjnc.co.kr/esvc/vessel/vesselStatus" target="_blank" class="terminal-btn">í˜„í™©</a></div></div></div>
                <div class="terminal-block"><div class="terminal-header" onclick="toggleContent('term-bnct')">ë¶€ì‚°ì‹ í•­ì»¨í…Œì´ë„ˆ (BNCT) â–¼</div><div id="term-bnct" class="terminal-body"><div class="terminal-actions"><a href="https://info.bnctkorea.com/esvc/vessel/berthScheduleT" target="_blank" class="terminal-btn">ìŠ¤ì¼€ì¤„</a><a href="https://info.bnctkorea.com/esvc/vessel/berthScheduleG" target="_blank" class="terminal-btn">ì°¨íŠ¸</a><a href="https://info.bnctkorea.com/esvc/vessel/vesselStatus" target="_blank" class="terminal-btn">í˜„í™©</a></div></div></div>
                <div class="terminal-block"><div class="terminal-header" onclick="toggleContent('term-dgt')">ë™ì›ë¡œì—‘ìŠ¤ (DGT) â–¼</div><div id="term-dgt" class="terminal-body"><div class="terminal-actions"><a href="https://www.dgtbusan.com/DGT/esvc/vessel/berthScheduleT" target="_blank" class="terminal-btn">ìŠ¤ì¼€ì¤„</a><a href="https://www.dgtbusan.com/DGT/esvc/vessel/berthScheduleG" target="_blank" class="terminal-btn">ì°¨íŠ¸</a><a href="https://www.dgtbusan.com/DGT/esvc/vessel/vesselStatus" target="_blank" class="terminal-btn">í˜„í™©</a></div></div></div>
            </div>
        </div>

        <div class="card" style="border-left: 5px solid #10b981;">
            <div class="section-header" onclick="toggleSection('t2-content', this)"><span class="section-title">ğŸ—ï¸ 2í•­ì—… (ì‹ í•­ ë¶ì¸¡) â–¼</span></div>
            <div id="t2-content" class="collapsible-content collapsed">
                <div class="terminal-block"><div class="terminal-header" onclick="toggleContent('term-pnc')">ë¶€ì‚°ì‹ í•­ë§Œ (PNC) â–¼</div><div id="term-pnc" class="terminal-body"><div class="terminal-actions"><a href="https://svc.pncport.com/info/CMS/Ship/Info.pnc?mCode=MN014" target="_blank" class="terminal-btn">ìŠ¤ì¼€ì¤„</a><a href="https://svc.pncport.com/info/CMS/Ship/ShipBerthC.pnc?mCode=MN019" target="_blank" class="terminal-btn">ì°¨íŠ¸</a><a href="https://svc.pncport.com/info/CMS/Ship/ShipVslStatus.pnc?mCode=MN020" target="_blank" class="terminal-btn">í˜„í™©</a></div><button class="action-btn" style="background:#f39c12; margin-top:8px; padding:10px;" onclick="openBusSchedule()">ğŸšŒ ì…”í‹€ë²„ìŠ¤ ì‹œê°„í‘œ</button></div></div>
                <div class="terminal-block"><div class="terminal-header" onclick="toggleContent('term-hpnt')">HMM (HPNT) â–¼</div><div id="term-hpnt" class="terminal-body"><div class="terminal-actions"><a href="https://www.hpnt.co.kr/main/vessel/schedule/list" target="_blank" class="terminal-btn">ìŠ¤ì¼€ì¤„</a><a href="https://www.hpnt.co.kr/main/vessel/berth/list" target="_blank" class="terminal-btn">ì„ ì„</a></div></div></div>
                <div class="terminal-block"><div class="terminal-header" onclick="toggleContent('term-pnit')">ì‹ í•­êµ­ì œ (PNIT) â–¼</div><div id="term-pnit" class="terminal-body"><div class="terminal-actions"><a href="http://www.pnitl.com" target="_blank" class="terminal-btn">í™ˆí˜ì´ì§€</a></div></div></div>
            </div>
        </div>

        <div class="card" style="border-left: 5px solid #f97316;">
            <div class="section-header" onclick="toggleSection('t1-content', this)"><span class="section-title">âš“ 1í•­ì—… (ë¶í•­) â–¼</span></div>
            <div id="t1-content" class="collapsible-content collapsed">
                <div class="terminal-block"><div class="terminal-header" onclick="toggleContent('term-bptc')">ë¶í•­ í†µí•© (BPTC) â–¼</div><div id="term-bptc" class="terminal-body"><div class="terminal-actions"><a href="http://info.bptc.co.kr:9084" target="_blank" class="terminal-btn" style="grid-column:span 3;">ğŸ—ï¸ ê°ë§Œ/ì‹ ì„ ëŒ€ í†µí•© ì„ ì„</a></div></div></div>
                <div class="terminal-block"><div class="terminal-header" onclick="toggleContent('term-hbct')">í—ˆì¹˜ìŠ¨ (HBCT/ìì„±ëŒ€) â–¼</div><div id="term-hbct" class="terminal-body"><div class="terminal-actions"><a href="https://www.hutchisonportsbusan.com" target="_blank" class="terminal-btn">í™ˆí˜ì´ì§€</a></div></div></div>
            </div>
        </div>

        <div class="card"><div class="section-header" onclick="toggleSection('control-content', this)"><span class="section-title">ğŸ“¡ ê´€ì œ ë° ì‹¤ì‹œê°„ ê¸°ìƒ â–¼</span></div><div id="control-content" class="collapsible-content collapsed"><div class="control-grid"><a href="http://www.busanpilot.co.kr/popup/monitoring" class="control-btn" target="_blank">ğŸ›¥ï¸ ë„ì„  ëª¨ë‹ˆí„°</a><a href="https://weather.naver.com/today/08440585" class="control-btn" target="_blank" style="grid-column: span 2; color:var(--danger);">â˜€ï¸ ë¶€ì‚°í•­ ì‹¤ì‹œê°„ ë‚ ì”¨</a></div></div></div>
        <div class="card" style="border-left: 5px solid var(--primary);"><div class="section-header" onclick="toggleSection('ads-info-1', this)"><span class="section-title">ğŸ“˜ ë¶€ì‚°í•­ ì´ìš© ë° ì•ˆì „ ê·¼ë¬´ ê°€ì´ë“œ â–¼</span></div><div id="ads-info-1" class="collapsible-content collapsed"><div class="guide-text"><h4>ğŸ“Œ 2026ë…„ ë¶€ì‚°í•­ í„°ë¯¸ë„ ì¶œì… ë° ë³´ì•ˆ ê·œì •</h4><p>ë¶€ì‚°í•­ ë‚´ ëª¨ë“  í„°ë¯¸ë„(PNC, HJNC, BCT ë“±)ì€ êµ­ê°€ ì¤‘ìš” ë³´ì•ˆ ì‹œì„¤ë¡œ ì§€ì •ë˜ì–´ ì¶œì… ì‹œ ì‚¬ì „ ë“±ë¡ì´ í•„ìˆ˜ì…ë‹ˆë‹¤.</p><h4>ğŸŒ§ï¸ ê¸°ìƒ ì•…í™” ì‹œ í•˜ì—­ ì‘ì—… ì¤‘ë‹¨ ê¸°ì¤€</h4><p>í•­ë§Œ ì—…ë¬´ëŠ” í’ì†ê³¼ ê°•ìˆ˜ëŸ‰ì— ë¯¼ê°í•©ë‹ˆë‹¤. í†µìƒ ìˆœê°„í’ì† 15m/s ì´ˆê³¼ ì‹œ ì•ˆë²½ í¬ë ˆì¸(QC) ì‘ì—…ì´ ì¼ì‹œ ì¤‘ë‹¨ë©ë‹ˆë‹¤.</p></div></div></div>

        <div class="dash-grid">
            <div id="notice-card" class="dash-card"><div class="dash-header" onclick="toggleDashItem('notice-card')">ğŸ“¢ ê³µì§€ì‚¬í•­ â–¼</div><div class="dash-content"><div style="margin-bottom:10px; background:rgba(239,68,68,0.05); padding:10px; border-radius:8px;"><input type="text" id="noticeTitle" class="input-field" placeholder="ì œëª©"><textarea id="noticeContent" class="input-field textarea-field" placeholder="ë‚´ìš©" style="height: 80px; resize: none; text-align: left;"></textarea><button class="action-btn bg-submit" onclick="addNotice()">ê³µì§€ ë“±ë¡ (Admin)</button></div><ul id="noticeList" class="post-list" style="margin-top:10px;"></ul></div></div>
            <div id="board-card" class="dash-card"><div class="dash-header" onclick="toggleDashItem('board-card')">ğŸ’¬ ìµëª…ê²Œì‹œíŒ â–¼</div><div class="dash-content"><button class="action-btn" style="background:var(--text-sub); margin-bottom:10px;" onclick="toggleHidden('boardForm')">âœï¸ ê¸€ì“°ê¸°</button><div id="boardForm" class="hidden"><input type="text" id="inputTitle" class="input-field" placeholder="ì œëª©"><input type="password" id="inputPw" class="input-field" placeholder="ë¹„ë²ˆ"><textarea id="inputContent" class="input-field textarea-field" placeholder="ë‚´ìš©" style="height: 80px; resize: none; text-align: left;"></textarea><button class="action-btn bg-submit" onclick="addPost()">ë“±ë¡</button></div><ul id="boardList" class="post-list"></ul><div id="pagination" style="display:flex; justify-content:center; gap:5px; margin-top:10px;"></div></div></div>
            <div id="ship-card" class="dash-card"><div class="dash-header" onclick="toggleDashItem('ship-card')">ğŸš¢ ì„ ë°•ì •ë³´ â–¼</div><div class="dash-content"><div style="display:flex; gap:5px; margin-bottom:10px;"><input type="text" id="shipSearch" class="input-field" placeholder="ì„ ë°• ê²€ìƒ‰" onkeyup="filterShips()" style="margin-bottom:0;"><button class="action-btn" style="width:auto;" onclick="filterShips()">ğŸ”</button></div><a href="https://www.marinetraffic.com/" target="_blank" class="action-btn" style="background:#0284c7; text-align:center; display:block; text-decoration:none; margin-bottom:10px; padding:12px;">ğŸŒ ì‹¤ì‹œê°„ ì„ ë°• ìœ„ì¹˜ í™•ì¸</a><button class="action-btn" style="background:var(--accent); margin-bottom:10px;" onclick="toggleHidden('shipForm')">ğŸ“ ì„ ë°• ì •ë³´ ì‹ ê·œ ë“±ë¡</button><div id="shipForm" class="hidden"><input type="text" id="shipName" class="input-field" placeholder="ì„ ë°•ëª…"><textarea id="shipOnboard" class="input-field textarea-field" placeholder="ì‘ì—…ë‚´ìš©" style="height: 80px; resize: none; text-align: left;"></textarea><input type="file" id="shipFileInput" class="input-field"><button id="shipSubmitBtn" class="action-btn bg-submit" onclick="addShipInfo()">ë“±ë¡/ìˆ˜ì •</button></div><ul id="shipList" class="post-list"></ul></div></div>
            <div id="file-card" class="dash-card"><div class="dash-header" onclick="toggleDashItem('file-card')">ğŸ“‚ ìë£Œì‹¤ â–¼</div><div class="dash-content"><input type="text" id="fileTitle" class="input-field" placeholder="íŒŒì¼ ì œëª©"><input type="file" id="fileInput" class="input-field"><button class="action-btn bg-submit" onclick="uploadFile()">ì—…ë¡œë“œ</button><ul id="fileList" class="post-list" style="margin-top:10px;"></ul></div></div>
        </div>

        <footer><p>Â© 2026 BUSAN HAK PORT INFO. All rights reserved.</p><div style="margin-top:10px;"><span class="footer-link" onclick="openPrivacy()" style="cursor: pointer; text-decoration: underline;">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</span></div></footer>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="scrollToTop()">ğŸ  í™ˆ</div>
        <div class="nav-item" onclick="toggleDashItem('board-card')">ğŸ’¬ í†¡í†¡</div>
        <div class="nav-item" onclick="toggleDashItem('ship-card')">ğŸš¢ ì„ ë°•</div>
        <div class="nav-item" onclick="toggleDashItem('file-card')">ğŸ“‚ ìë£Œ</div>
    </nav>
    
    <div id="toast">ì•Œë¦¼</div>
    <div id="imageModal" class="modal-overlay" onclick="closeImageModal()"><div class="modal-content" onclick="event.stopPropagation()"><img id="modalImage" class="modal-img"><button class="action-btn bg-cancel" onclick="closeImageModal()">ë‹«ê¸°</button></div></div>
    <div id="privacyModal" class="modal-overlay" onclick="document.getElementById('privacyModal').style.display='none'"><div class="modal-content"><h3>ğŸ›¡ï¸ ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</h3><p>ë³¸ ì‚¬ì´íŠ¸ëŠ” ì¿ í‚¤ë¥¼ ì‚¬ìš©í•˜ë©° ê·¼ë¬´ ê¸°ë¡ ë° ê²Œì‹œë¬¼ ë°ì´í„°ëŠ” Firebase ì„œë²„ì— ì•ˆì „í•˜ê²Œ ë³´ê´€ë©ë‹ˆë‹¤.</p><button class="action-btn" onclick="document.getElementById('privacyModal').style.display='none'">ë‹«ê¸°</button></div></div>
    <div id="loginModal" class="modal-overlay" style="display:none;" onclick="closeLoginModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3>ğŸ” ê·¼ë¬´ì¼ì§€ ë¡œê·¸ì¸/ê°€ì…</h3>
            <p>ë‹‰ë„¤ì„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
            <input type="text" id="loginNick" class="input-field" placeholder="ë‹‰ë„¤ì„ (ID)">
            <input type="password" id="loginPw" class="input-field" placeholder="ë¹„ë°€ë²ˆí˜¸">
            <button class="action-btn" onclick="confirmLoginAndSave()">í™•ì¸ ë° ì €ì¥</button>
            <button class="action-btn bg-cancel" onclick="closeLoginModal()">ì·¨ì†Œ</button>
        </div>
    </div>
    <div id="tickerManageModal" class="modal-overlay" onclick="document.getElementById('tickerManageModal').style.display='none'"><div class="modal-content" onclick="event.stopPropagation()"><h3 style="margin-top:0;">âš™ï¸ ì•Œë¦¼ê¸€ ì‚­ì œ</h3><div id="tickerListContainer"></div><button class="action-btn bg-cancel" onclick="document.getElementById('tickerManageModal').style.display='none'" style="margin-top:10px;">ë‹«ê¸°</button></div></div>
    <script>
        /* 1ï¸âƒ£ Firebase ì„¤ì • (busan-hak-port í”„ë¡œì íŠ¸ë¡œ í†µì¼) */
        const firebaseConfig = {
            apiKey: "AIzaSyBWFZr9TE9yybZJCJjEXSsv1YCpGkVb0kA",
            authDomain: "busan-hak-port.firebaseapp.com",
            projectId: "busan-hak-port",
            storageBucket: "busan-hak-port.appspot.com",
            messagingSenderId: "667323279185",
            appId: "1:667323279185:web:cff6184aaa82e08d345570"
        };
        
        // Firebase ì´ˆê¸°í™” (ì¤‘ë³µ ë°©ì§€)
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        const storage = firebase.storage();

        /* 2ï¸âƒ£ ì „ì—­ ë³€ìˆ˜ */
        let allPostsData=[], allShipsData=[], filteredShips=[], adminWorkLogs={};
        let currentDate = new Date();
        let currentWorkerId = localStorage.getItem('myWorkerId'); 
        let commentUnsubscribes = {};
        const postsPerPage = 5;

        /* 3ï¸âƒ£ í•µì‹¬ ê¸°ëŠ¥ í•¨ìˆ˜ */

        // --- [A] ê³µí†µ ìœ í‹¸ë¦¬í‹° ---
        async function verifyAdmin(){ 
            return prompt("ê´€ë¦¬ì ì•”í˜¸(0346)ë¥¼ ì…ë ¥í•˜ì„¸ìš”:") === "0346"; 
        }

        function toggleDashItem(id){ 
            const c = document.getElementById(id);
            if(!c) return; 
            const isExpanded = c.classList.contains('expanded'); 
            
            // ë‹¤ë¥¸ ì¹´ë“œ ë‹«ê¸°
            document.querySelectorAll('.dash-card').forEach(x=>{
                x.classList.remove('expanded'); 
                const content = x.querySelector('.dash-content');
                if(content) content.style.display='none';
            }); 
            
            // í˜„ì¬ ì¹´ë“œ ì—´ê¸°
            if(!isExpanded){
                c.classList.add('expanded'); 
                const content = c.querySelector('.dash-content');
                if(content) content.style.display='block'; 
                if(id === 'log-card') renderCalendar(currentDate.getFullYear(), currentDate.getMonth()); 
            }
        }

        function toggleSection(id){ document.getElementById(id).classList.toggle('collapsed'); }
        function toggleContent(id){ const e=document.getElementById(id); e.style.display=(e.style.display==='block'?'none':'block'); }
        function toggleHidden(id){ document.getElementById(id).classList.toggle('hidden'); }
        function toggleDarkMode(){ document.body.classList.toggle('dark-mode'); }
        function scrollToTop(){ window.scrollTo({top:0, behavior:'smooth'}); }
        function showToast(m){const t=document.getElementById("toast"); t.innerText=m; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"),3000);}

        // --- [B] íë¥´ëŠ” ê¸€ (ë°°ë„ˆ) ë¡œì§ [ìˆ˜ì •ë¨] ---
        function loadBanner() {
            db.collection('settings').doc('banner').onSnapshot(doc => {
                if(doc.exists && doc.data().messages) {
                    const msgs = doc.data().messages; // ë°°ì—´ ê°€ì ¸ì˜¤ê¸°
                    document.getElementById('tickerText').innerText = "ğŸš¨ " + msgs.join("   ///   ");
                } else {
                    document.getElementById('tickerText').innerText = "ğŸš¨ ì•ˆì „ ì œì¼! ì˜¤ëŠ˜ë„ ë¬´ì‚¬ê³ !";
                }
            });
        }

        function updateBanner() {
            const newText = prompt("ìƒˆë¡œìš´ ì•ˆì „ ê³µì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
            if (!newText) return;

            const bannerRef = db.collection('settings').doc('banner');
            bannerRef.get().then((doc) => {
                let msgs = doc.exists && doc.data().messages ? doc.data().messages : [];
                msgs.unshift(newText); // ë§¨ ì•ì— ì¶”ê°€
                if (msgs.length > 5) msgs = msgs.slice(0, 5); // 5ê°œ ìœ ì§€
                
                return bannerRef.set({ messages: msgs }, { merge: true });
            }).then(() => {
                showToast("ë°°ë„ˆê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
            }).catch(err => alert("ë“±ë¡ ì‹¤íŒ¨: " + err.message));
        }

        // --- [C] ìŠ¤ë§ˆíŠ¸ ê·¼ë¬´ì¼ì§€ ë¡œì§ ---
        function renderCalendar(y, m){
            const g = document.getElementById('calendarGrid'); 
            g.innerHTML = "";
            document.getElementById('calMonthYear').innerText = `${y}ë…„ ${m+1}ì›”`;
            
            const fD = new Date(y, m, 1).getDay(), lD = new Date(y, m+1, 0).getDate();
            
            for(let i=0; i<fD; i++) g.innerHTML += `<div></div>`;
            for(let d=1; d<=lD; d++){
                const dStr = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                g.innerHTML += `<div id="cal-day-${d}" class="cal-day" onclick="clickDate('${dStr}')">${d}<div class="cal-dot"></div></div>`;
            }

            if(currentWorkerId) {
                const sDate = `${y}-${String(m+1).padStart(2,'0')}-01`, eDate = `${y}-${String(m+1).padStart(2,'0')}-${lD}`;
                db.collection('work_logs').where('date', '>=', sDate).where('date', '<=', eDate).get().then(s => {
                    adminWorkLogs = {};
                    let total = 0;
                    s.forEach(doc => {
                        const data = doc.data();
                        if(data.workerId === currentWorkerId) {
                            adminWorkLogs[data.date] = data; 
                            const day = parseInt(data.date.split('-')[2]);
                            const el = document.getElementById(`cal-day-${day}`);
                            if(el) el.classList.add('has-data');
                            total += (data.totalPay || 0);
                        }
                    });
                    document.getElementById('monthlyTotalDisplay').innerText = `ì´ë²ˆë‹¬ ì´ì•¡: ${total.toLocaleString()}ì›`;
                });
            }
        }

        function clickDate(dStr){
            document.getElementById('selectedDateText').innerText = dStr;
            document.getElementById('dailyLogForm').classList.remove('hidden');
            document.getElementById('dailyLogForm').setAttribute('data-date', dStr);
            
            const d = adminWorkLogs[dStr];
            document.getElementById('logDayHours').value = d ? d.dayHours : '';
            document.getElementById('logNightHours').value = d ? d.nightHours : '';
            document.getElementById('logMemo').value = d ? d.memo : '';
            
            const img = document.getElementById('logImagePreview');
            if(d && d.imageUrl){ img.src = d.imageUrl; img.style.display = 'block'; } 
            else { img.style.display = 'none'; img.src = ""; }
        }

        function trySaveWorkLog(){
            if(currentWorkerId) saveWorkLog();
            else document.getElementById('loginModal').style.display = 'flex';
        }

        function confirmLoginAndSave(){
            const nick = document.getElementById('loginNick').value.trim();
            const pw = document.getElementById('loginPw').value.trim();
            if(!nick || !pw) return alert("ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

            db.collection('user_profiles').doc(nick).get().then(doc => {
                if ((doc.exists && doc.data().password === pw) || !doc.exists) {
                    if(!doc.exists) db.collection('user_profiles').doc(nick).set({password: pw});
                    currentWorkerId = nick;
                    localStorage.setItem('myWorkerId', nick);
                    updateUserBar();
                    document.getElementById('loginModal').style.display = 'none';
                    saveWorkLog();
                } else {
                    alert("ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜");
                }
            });
        }

        function saveWorkLog(){
            const dStr = document.getElementById('dailyLogForm').getAttribute('data-date');
            const dh = parseFloat(document.getElementById('logDayHours').value)||0;
            const nh = parseFloat(document.getElementById('logNightHours').value)||0;
            const memo = document.getElementById('logMemo').value;
            const file = document.getElementById('logImageInput').files[0];
            const pay = (dh*10320) + (nh*15480); // ì˜ˆì‹œ ì‹œê¸‰
            const docId = `${currentWorkerId}_${dStr}`;

            const saveDB = (url) => {
                db.collection('work_logs').doc(docId).set({
                    date: dStr, workerId: currentWorkerId, dayHours: dh, nightHours: nh, memo: memo, totalPay: pay, imageUrl: url
                }, {merge: true}).then(() => {
                    showToast("ì €ì¥ ì™„ë£Œ!");
                    renderCalendar(currentDate.getFullYear(), currentDate.getMonth()); // ë‹¬ë ¥ ê°±ì‹ 
                });
            };

            if(file) storage.ref(`logs/${currentWorkerId}/${Date.now()}`).put(file).then(s=>s.ref.getDownloadURL()).then(u=>saveDB(u));
            else saveDB(adminWorkLogs[dStr]?.imageUrl || null);
        }

        function logoutWorker() {
            if(confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                localStorage.removeItem('myWorkerId');
                location.reload();
            }
        }
        
        function updateUserBar() {
            if(currentWorkerId) {
                document.getElementById('userProfileBar').style.display = 'flex';
                document.getElementById('currentUserDisplay').innerText = `ğŸ‘¤ ${currentWorkerId}`;
            }
        }
        function changeMonth(s){ currentDate.setMonth(currentDate.getMonth()+s); renderCalendar(currentDate.getFullYear(), currentDate.getMonth()); }

        // --- [D] ì„ê¸ˆê³„ì‚°ê¸° ---
        function calculateWage() {
            const totalHours = parseFloat(document.getElementById('wageTotalHours').value) || 0;
            const hourly = parseFloat(document.getElementById('wageHourly').value);
            const result = totalHours * hourly;
            document.getElementById('wageTotal').innerText = `ì˜ˆìƒ: ${result.toLocaleString()}ì›`;
            document.getElementById('wageResultBox').classList.remove('hidden');
        }

        // --- [E] ê³µì§€/ê²Œì‹œíŒ/ì„ ë°•/ìë£Œ ---
        function addNotice(){ 
            verifyAdmin().then(isAuth => {
                if(!isAuth) return alert("ì¸ì¦ ì‹¤íŒ¨");
                const t = document.getElementById('noticeTitle').value;
                const c = document.getElementById('noticeContent').value;
                if(t && c) db.collection("notices").add({title:t, content:c, timestamp:firebase.firestore.FieldValue.serverTimestamp()}).then(()=>{
                    document.getElementById('noticeTitle').value=''; document.getElementById('noticeContent').value='';
                    showToast("ê³µì§€ ë“±ë¡ë¨");
                });
            }); 
        }

        function addPost(){ 
            const t=document.getElementById('inputTitle').value, p=document.getElementById('inputPw').value, c=document.getElementById('inputContent').value; 
            if(t&&p&&c) db.collection("posts").add({title:t, password:p, content:c, timestamp:firebase.firestore.FieldValue.serverTimestamp()}).then(()=>{
                document.getElementById('inputTitle').value=''; document.getElementById('inputPw').value=''; document.getElementById('inputContent').value=''; 
                toggleHidden('boardForm'); showToast("ê²Œì‹œê¸€ ë“±ë¡ë¨");
            }); 
        }

        function addShipInfo(){
            const n=document.getElementById('shipName').value, c=document.getElementById('shipOnboard').value, f=document.getElementById('shipFileInput').files[0]; 
            const save=(u)=>{db.collection("ships").add({shipName:n, onboardFeat:c, imageUrl:u, timestamp:firebase.firestore.FieldValue.serverTimestamp()}).then(()=>{
                document.getElementById('shipName').value=''; document.getElementById('shipOnboard').value=''; toggleHidden('shipForm'); showToast("ì„ ë°• ë“±ë¡ë¨");
            });}; 
            if(f) storage.ref(`ships/${Date.now()}`).put(f).then(s=>s.ref.getDownloadURL()).then(u=>save(u)); else save(null);
        }

        function uploadFile(){ 
            const f=document.getElementById('fileInput').files[0], t=document.getElementById('fileTitle').value; 
            if(f&&t) storage.ref(`archives/${Date.now()}`).put(f).then(s=>s.ref.getDownloadURL()).then(u=>db.collection("archives").add({title:t, url:u, timestamp:firebase.firestore.FieldValue.serverTimestamp()})).then(()=>{
                showToast("ì—…ë¡œë“œë¨"); document.getElementById('fileTitle').value='';
            }); 
        }

        // --- [F] ë°ì´í„° ë¡œë“œ (ì‹¤ì‹œê°„) ---
        window.onload = () => {
            loadBanner();
            updateUserBar();

            // ê³µì§€ì‚¬í•­
            db.collection("notices").orderBy("timestamp","desc").onSnapshot(s=>{
                const l=document.getElementById("noticeList"); l.innerHTML=""; 
                s.forEach(d=>{const x=d.data(); l.innerHTML+=`<li class="post-item" onclick="toggleContent('n-${d.id}')">ğŸ“¢ <strong>${x.title}</strong><div id="n-${d.id}" class="post-body-content">${x.content}</div></li>`;});
            }); 

            // ê²Œì‹œíŒ
            db.collection("posts").orderBy("timestamp","desc").limit(10).onSnapshot(s=>{
                const l=document.getElementById("boardList"); l.innerHTML=""; 
                s.forEach(d=>{const x=d.data(); l.innerHTML+=`<li class="post-item"><div class="post-header-row" onclick="toggleContent('p-${d.id}')"><span class="post-title-text">${x.title}</span></div><div id="p-${d.id}" class="post-body-content">${x.content}</div></li>`;});
            });

            // ì„ ë°•
            db.collection("ships").orderBy("timestamp","desc").limit(10).onSnapshot(s=>{
                allShipsData=[]; s.forEach(d=>{allShipsData.push({...d.data(), id:d.id})}); filteredShips=allShipsData; renderShipList();
            });

            // ìë£Œ
            db.collection("archives").orderBy("timestamp","desc").limit(10).onSnapshot(s=>{
                const l=document.getElementById("fileList"); l.innerHTML=""; 
                s.forEach(d=>{const x=d.data(); l.innerHTML+=`<li class="post-item"><a href="${x.url}" target="_blank">ğŸ’¾ ${x.title}</a></li>`;});
            });
        };

        function renderShipList(){
            const l=document.getElementById("shipList"); l.innerHTML=""; 
            filteredShips.forEach(x=>{l.innerHTML+=`<li class="post-item" onclick="toggleContent('s-${x.id}')">ğŸš¢ ${x.shipName}<div id="s-${x.id}" class="post-body-content">${x.onboardFeat}</div></li>`;});
        }
        function filterShips(){ const q=document.getElementById('shipSearch').value; filteredShips=allShipsData.filter(s=>s.shipName.includes(q)); renderShipList(); }
        function openBusSchedule(){ document.getElementById('imageModal').style.display='flex'; document.getElementById('modalImage').src='http://pasc.dothome.co.kr/pnitbus.jpg'; } // ì´ë¯¸ì§€ ê²½ë¡œ í™•ì¸ í•„ìš”
        function closeImageModal(){ document.getElementById('imageModal').style.display='none'; }
        function openPrivacy(){ document.getElementById('privacyModal').style.display='flex'; }
        function closeLoginModal(){ document.getElementById('loginModal').style.display='none'; }
    </script>
</body>
</html>
