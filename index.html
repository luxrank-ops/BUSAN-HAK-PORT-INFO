<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BUSAN HAK PORT INFO</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">

    <style>
        :root {
            --primary-color: #003366;
            --accent-color: #f39c12;
            --bg-color: #f4f6f9;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-color: #eee;
            --input-bg: #fff;
            --nav-bg: #ffffff;
            --nav-text: #666;
            --nav-active: #003366;
        }

        body.dark-mode {
            --primary-color: #bbdefb;
            --accent-color: #ffb74d;
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --border-color: #333;
            --input-bg: #2c2c2c;
            --nav-bg: #1e1e1e;
            --nav-text: #888;
            --nav-active: #bbdefb;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            padding-bottom: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: background-color 0.3s, color 0.3s;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ (3D) */
        header {
            width: 100%;
            background-color: #003366;
            color: white;
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            display: flex; justify-content: center; align-items: center;
            z-index: 100;
        }
        
        header h1 {
            margin: 0;
            font-size: 1.6rem;
            letter-spacing: 2px;
            font-weight: 800;
            color: #ffffff;
            text-shadow: 0 1px 0 #d4d4d4, 0 2px 0 #a8a8a8, 0 3px 5px rgba(0,0,0,0.4);
            animation: subtleFloat 3s ease-in-out infinite alternate;
        }
        @keyframes subtleFloat {
            0% { transform: translateY(0); text-shadow: 0 1px 0 #d4d4d4, 0 2px 0 #a8a8a8, 0 3px 5px rgba(0,0,0,0.4); }
            100% { transform: translateY(-4px); text-shadow: 0 4px 0 #d4d4d4, 0 6px 0 #a8a8a8, 0 10px 10px rgba(0,0,0,0.3); }
        }
        
        .theme-toggle {
            position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
            background: none; border: none; font-size: 1.5rem; cursor: pointer; color: white;
        }

        /* ì•ˆì „ ë°°ë„ˆ */
        .ticker-container {
            width: 100%;
            background-color: #ff9800;
            color: #000;
            height: 45px;
            overflow: hidden;
            position: relative;
            display: flex; 
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-bottom: 1px solid #e65100;
        }
        .ticker-wrap {
            width: 100%;
            overflow: hidden;
            padding-right: 90px;
        }
        .ticker-item {
            display: inline-block;
            white-space: nowrap;
            padding-left: 100%;
            font-weight: 900;
            font-size: 1.0rem;
            line-height: 45px;
            animation: ticker-move 20s linear infinite, blink-text 1.5s infinite;
        }
        @keyframes blink-text {
            0% { color: #000; text-shadow: none; }
            50% { color: #d50000; text-shadow: 0 0 5px rgba(255,255,255,0.8); }
            100% { color: #000; text-shadow: none; }
        }
        @keyframes ticker-move {
            0% { transform: translate3d(0, 0, 0); }
            100% { transform: translate3d(-100%, 0, 0); }
        }
        
        .ticker-btn-group {
            position: absolute; right: 0; top: 0; height: 100%;
            display: flex;
        }
        .ticker-btn {
            height: 45px; width: 45px;
            background: rgba(0,0,0,0.1); border: none; cursor: pointer;
            font-size: 1.2rem; color: #fff; 
            display: flex; align-items: center; justify-content: center;
            border-left: 1px solid rgba(255,255,255,0.2);
        }
        .ticker-btn:active { background: rgba(0,0,0,0.3); }

        .container { width: 95%; max-width: 800px; margin: 20px auto; }
        
        .section-card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: background-color 0.3s;
        }
        
        .section-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 5px;
            margin-bottom: 15px;
            display: flex; justify-content: space-between; align-items: center;
        }

        .toggle-block {
            width: 100%; padding: 15px; margin-bottom: 10px; border-radius: 8px;
            font-weight: bold; font-size: 1.05rem; cursor: pointer; text-align: left;
            display: flex; justify-content: space-between; align-items: center;
            border: 1px solid rgba(0,0,0,0.05); box-sizing: border-box; color: #333;
        }
        .toggle-block::after { content: "â–¼"; font-size: 0.8rem; opacity: 0.6; }

        .bg-khaki { background-color: #e6ee9c; color: #33691e; }
        .bg-blue { background-color: #bbdefb; color: #0d47a1; }
        .bg-green { background-color: #c8e6c9; color: #1b5e20; }
        .bg-purple { background-color: #e1bee7; color: #4a148c; }

        .hidden-content { display: none; padding: 10px 5px; animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

        .btn-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px;}
        .btn {
            background-color: var(--card-bg); border: 1px solid var(--border-color); 
            color: var(--text-color); border-radius: 4px; padding: 12px 0;
            text-align: center; font-size: 0.85rem; text-decoration: none; font-weight: 600; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }
        .btn:hover { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }

        .board-form { background: var(--bg-color); padding: 15px; border-radius: 5px; margin-bottom: 15px; border: 1px solid var(--border-color); }
        .board-input { 
            width: 100%; padding: 10px; margin-bottom: 10px; 
            border: 1px solid var(--border-color); border-radius: 4px; box-sizing: border-box; 
            background-color: var(--input-bg); color: var(--text-color);
        }
        textarea.board-input { height: 80px; resize: vertical; }
        .board-btn { background-color: #003366; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 0.9rem; }
        
        .search-box { 
            width: 100%; padding: 10px; margin-bottom: 15px; 
            border: 2px solid var(--accent-color); border-radius: 5px; font-size: 0.95rem; box-sizing: border-box;
            background-color: var(--input-bg); color: var(--text-color);
        }
        
        .post-list { list-style: none; padding: 0; margin: 0; }
        .post-item { 
            border: 1px solid var(--border-color); border-radius: 5px; margin-bottom: 10px; 
            background: var(--card-bg); overflow: hidden; 
        }
        .post-header { 
            display: flex; justify-content: space-between; padding: 15px; cursor: pointer; 
            background-color: var(--card-bg); align-items: center; border-bottom: 1px solid transparent;
        }
        .post-header:hover { background-color: rgba(0,0,0,0.02); }
        
        .post-title { font-weight: bold; color: var(--primary-color); font-size: 0.75rem; flex: 1; }
        .post-cat { color: var(--accent-color); font-size: 0.75rem; margin-right: 5px; } 
        .post-info { font-size: 0.7rem; color: #888; text-align: right; margin-left: 10px;}
        
        .delete-btn { background-color: #e53935; color: white; border: none; border-radius: 3px; padding: 3px 8px; font-size: 0.7rem; margin-left: 5px; cursor: pointer; z-index: 10; }
        .edit-btn { background-color: #1976d2; color: white; border: none; border-radius: 3px; padding: 3px 8px; font-size: 0.7rem; margin-left: 5px; cursor: pointer; z-index: 10; }
        .photo-btn { background-color: #00897b; color: white; border: none; border-radius: 3px; padding: 3px 8px; font-size: 0.7rem; margin-left: 5px; cursor: pointer; z-index: 10; text-decoration: none;}
        .download-btn { background-color: #2e7d32; color: white; border: none; border-radius: 3px; padding: 5px 10px; font-size: 0.75rem; margin-left: 10px; cursor: pointer; z-index: 10; text-decoration: none; }

        .post-body-container { display: none; padding: 15px; border-top: 1px dashed var(--border-color); background-color: rgba(0,0,0,0.02); }
        .post-content { white-space: pre-wrap; margin-bottom: 15px; line-height: 1.5; font-size: 0.9rem; color: var(--text-color);}
        
        .comment-section { background: var(--bg-color); padding: 10px; border-radius: 5px; border: 1px solid var(--border-color); }
        .comment-input-area { display: flex; gap: 5px; margin-bottom: 10px; }
        .comment-input { flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 0.85rem; background: var(--input-bg); color: var(--text-color); margin-right: 5px;}
        .comment-btn { background: #6c757d; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; }
        .comment-list { list-style: none; padding: 0; margin: 0; }
        .comment-item { font-size: 0.85rem; border-bottom: 1px solid var(--border-color); padding: 8px 0; display: flex; justify-content: space-between; }
        
        .file-input-wrapper { margin-bottom: 10px; }
        .file-item { padding: 15px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .file-link { text-decoration: none; color: var(--text-color); font-weight: 500; display: flex; align-items: center; gap: 5px; flex: 1; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;}
        .file-link:hover { color: var(--primary-color); text-decoration: underline; }
        .file-meta { font-size: 0.75rem; color: #999; margin-top: 2px;}
        
        .comm-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .comm-btn { 
            background-color: var(--card-bg); border: 1px solid var(--primary-color); color: var(--primary-color); 
            padding: 15px 5px; text-align: center; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 0.95rem;
            display: flex; flex-direction: column; justify-content: center; align-items: center; line-height: 1.3;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .comm-btn.active { background-color: var(--primary-color); color: white; }
        
        .notice-box { background-color: #fff3cd; color: #856404; padding: 10px; border-radius: 5px; font-size: 0.9rem; margin-bottom: 20px; border: 1px solid #ffeeba; }
        
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); z-index: 2000; justify-content: center; align-items: center; }
        .modal-content { background: var(--card-bg); padding: 10px; border-radius: 8px; max-width: 95%; max-height: 90%; display: flex; flex-direction: column; align-items: center; }
        .modal-img { max-width: 100%; max-height: 70vh; border-radius: 5px; object-fit: contain; }
        .modal-close-btn { margin-top: 15px; padding: 12px; background: #333; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; width: 100%; }

        .pagination { display: flex; justify-content: center; gap: 5px; margin-top: 20px; }
        .page-btn { background-color: var(--card-bg); border: 1px solid var(--border-color); padding: 5px 12px; cursor: pointer; border-radius: 4px; font-size: 0.9rem; color: var(--text-color); }
        .page-btn.active { background-color: var(--primary-color); color: #fff; border-color: var(--primary-color); }
        
        .write-toggle-btn { width: 100%; padding: 12px; background-color: #546e7a; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-bottom: 10px; font-size: 0.95rem;}
        .ship-search-btn { display: block; width: 100%; padding: 12px; background: #0288D1; color: white; text-align: center; text-decoration: none; border-radius: 5px; font-weight: bold; margin-bottom: 10px; box-sizing: border-box; font-size: 0.95rem; cursor: pointer;}

        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 60px;
            background-color: var(--nav-bg); border-top: 1px solid var(--border-color);
            display: flex; justify-content: space-around; align-items: center;
            z-index: 1000; box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }
        .nav-item {
            flex: 1; text-align: center; color: var(--nav-text); text-decoration: none;
            font-size: 0.75rem; display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; cursor: pointer;
        }
        .nav-item span { font-size: 1.2rem; margin-bottom: 3px; }
        .nav-item:hover, .nav-item.active { color: var(--nav-active); font-weight: bold; }

        /* ê´€ë¦¬ì íŒì—… */
        .admin-list { width: 100%; list-style: none; padding: 0; margin: 10px 0; text-align: left; }
        .admin-item { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #eee; align-items: center; }
        .admin-del-btn { background: #e53935; color: white; border: none; border-radius: 3px; padding: 5px 10px; cursor: pointer; }

        /* íŒŒì¼ ì—…ë¡œë“œ ë²„íŠ¼ */
        .file-upload-label {
            display: block; width: 100%; padding: 12px;
            background-color: #e0f2f1; border: 2px dashed #00897b; border-radius: 5px;
            text-align: center; cursor: pointer; color: #00695c; font-weight: bold; font-size: 0.9rem;
            margin-bottom: 10px; box-sizing: border-box; transition: all 0.2s;
        }
        .file-upload-label:hover { background-color: #b2dfdb; }
        #shipFileInput { display: none; } 
    </style>
</head>
<body>

    <header>
        <h1>BUSAN HAK PORT INFO</h1>
        <button class="theme-toggle" onclick="toggleDarkMode()">ğŸŒ™</button>
    </header>

    <div id="safetyTicker" class="ticker-container">
        <div class="ticker-wrap">
            <div id="tickerText" class="ticker-item">ë¡œë”© ì¤‘...</div>
        </div>
        <div class="ticker-btn-group">
            <button class="ticker-btn" onclick="updateBanner()">âœï¸</button>
            <button class="ticker-btn" onclick="openBannerAdmin()">âš™ï¸</button>
        </div>
    </div>

    <div class="container">
        
        <div class="notice-box">
            ğŸ“¢ <strong>Tip:</strong> ì„ ë°• ì •ë³´ëŠ” ëˆ„êµ¬ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì‚­ì œëŠ” ê´€ë¦¬ìë§Œ)
        </div>

        <div id="section-community" class="section-card">
            <div class="section-title">ì»¤ë®¤ë‹ˆí‹° & ìë£Œì‹¤</div>
            
            <div class="comm-grid">
                <div class="comm-btn" onclick="toggleView('noticeArea')">ğŸ“¢ ê³µì§€ì‚¬í•­</div>
                <div class="comm-btn" onclick="toggleView('boardArea')">ğŸ’¬ ìµëª… ê²Œì‹œíŒ<br><span style="font-size:0.9rem; font-weight:bold;">(ê³ ì„±ë°©ê°€)</span></div>
                <div class="comm-btn" onclick="toggleView('fileArea')">ğŸ’¾ ê³µìœ ìë£Œì‹¤</div>
                <div class="comm-btn" onclick="toggleView('shipInfoArea')">
                    ğŸš¢ ì„ ë°• ì •ë³´ ê³µìœ <br>
                    <span style="font-size:0.8rem; color:var(--text-color); opacity:0.7; font-weight:normal;">(ëˆ„êµ¬ë‚˜ ìˆ˜ì • / ì‚­ì œëŠ” ê´€ë¦¬ìë§Œ)</span>
                </div>
            </div>

            <div id="noticeArea" class="hidden-content">
                <div class="board-form" style="border: 2px solid #d32f2f; background-color: rgba(211, 47, 47, 0.05);">
                    <p style="font-weight:bold; color:#d32f2f; margin-bottom:10px;">[ğŸ“¢ ì¤‘ìš” ê³µì§€ì‚¬í•­ ì‘ì„±]</p>
                    <p style="font-size:0.8rem; opacity:0.7; margin-bottom:10px;">â€» ê´€ë¦¬ì ì•”í˜¸ ì…ë ¥ ì‹œì—ë§Œ ë“±ë¡ë©ë‹ˆë‹¤.</p>
                    <input type="text" id="noticeTitle" class="board-input" placeholder="ê³µì§€ ì œëª©">
                    <input type="text" id="noticeName" class="board-input" placeholder="ì‘ì„±ì (ì˜ˆ: ê´€ë¦¬ì)">
                    <textarea id="noticeContent" class="board-input" placeholder="ê³µì§€ ë‚´ìš©..."></textarea>
                    <div style="text-align: right;">
                        <button class="board-btn" style="background-color:#d32f2f;" onclick="addNotice()">ê³µì§€ ë“±ë¡</button>
                    </div>
                </div>
                <ul id="noticeList" class="post-list">
                    <li style="text-align:center; padding:20px; opacity:0.6;">ë¡œë”© ì¤‘...</li>
                </ul>
            </div>
            
            <div id="boardArea" class="hidden-content">
                <button class="write-toggle-btn" onclick="toggleWriteForm('boardWriteForm')">ğŸ“ ê¸€ì“°ê¸°</button>
                <div id="boardWriteForm" class="board-form" style="display: none;">
                    <p style="font-weight:bold; color:var(--primary-color); margin-bottom:10px;">[ìµëª… ê¸€ì“°ê¸°]</p>
                    <select id="inputCategory" class="board-input" style="margin-bottom:10px;">
                        <option value="ì¡ë‹´">ì¡ë‹´</option>
                        <option value="ì£¼ì ˆì£¼ì ˆ">ì£¼ì ˆì£¼ì ˆ</option>
                        <option value="ë…¸ì¡°ì— ë°”ë€ë‹¤">ë…¸ì¡°ì— ë°”ë€ë‹¤</option>
                        <option value="ë¼ì‹±ì—…ë¬´">ë¼ì‹±ì—…ë¬´</option>
                        <option value="ê°œì„ ì œì•ˆ">ê°œì„ ì œì•ˆ</option>
                    </select>
                    <input type="text" id="inputTitle" class="board-input" placeholder="ì œëª©">
                    <div>
                        <input type="text" id="inputName" class="board-input" placeholder="ì‘ì„±ì" style="width:48%; display:inline-block;">
                        <input type="password" id="inputPw" class="board-input" placeholder="ë¹„ë²ˆ(ì‚­ì œìš©)" style="width:48%; display:inline-block; margin-left:2%;">
                    </div>
                    <textarea id="inputContent" class="board-input" placeholder="ë‚´ìš© ì…ë ¥..."></textarea>
                    <div style="text-align: right;">
                        <button class="board-btn" onclick="addPost()">ë“±ë¡</button>
                    </div>
                </div>
                <ul id="boardList" class="post-list">
                    <li style="text-align:center; padding:20px; opacity:0.6;">ë¡œë”© ì¤‘...</li>
                </ul>
                <div id="pagination" class="pagination"></div>
            </div>

            <div id="fileArea" class="hidden-content">
                <input type="text" id="fileSearch" class="search-box" placeholder="ğŸ” ìë£Œ ê²€ìƒ‰..." onkeyup="filterFiles()">
                <div class="board-form">
                    <p style="font-weight:bold; color:var(--primary-color); margin-bottom:10px;">[ìë£Œì‹¤ íŒŒì¼ ì—…ë¡œë“œ]</p>
                    <input type="text" id="fileTitle" class="board-input" placeholder="íŒŒì¼ ì œëª©">
                    <input type="text" id="fileUploader" class="board-input" placeholder="ì˜¬ë¦°ì´">
                    <input type="file" id="fileInput" class="board-input">
                    <div style="text-align: right;">
                        <button class="board-btn" onclick="uploadFile()">íŒŒì¼ ì—…ë¡œë“œ</button>
                    </div>
                    <div id="uploadProgress" style="color: blue; font-size: 0.8rem; margin-top: 5px; display: none;">ì—…ë¡œë“œ ì¤‘...</div>
                </div>
                <ul id="fileList" class="post-list">
                    <li style="text-align:center; padding:20px; opacity:0.6;">ë¡œë”© ì¤‘...</li>
                </ul>
                <div id="filePagination" class="pagination"></div>
            </div>

            <div id="shipInfoArea" class="hidden-content">
                <button class="write-toggle-btn" style="background-color: #00897b;" onclick="toggleWriteForm('shipWriteForm')">ğŸš¢ ì„ ë°• ì •ë³´ ì—…ë¡œë“œ</button>
                <a href="https://www.marinetraffic.com/" target="_blank" class="ship-search-btn">ğŸ” ì„ ë°• ìœ„ì¹˜ ê²€ìƒ‰ (MarineTraffic)</a>

                <div id="shipWriteForm" class="board-form" style="display: none; border-color: #00897b;">
                    <p style="font-weight:bold; color:#00695c; margin-bottom:10px;">[ì„ ë°• ì •ë³´ ê³µìœ ]</p>
                    <input type="text" id="shipName" class="board-input" placeholder="ì„ ë°• ì´ë¦„">
                    
                    <label for="shipFileInput" class="file-upload-label">
                        ğŸ“¸ ê·¸ë¦¼íŒŒì¼ ì„ íƒ (ì—¬ê¸°ë¥¼ í´ë¦­)
                    </label>
                    <input type="file" id="shipFileInput" accept="image/*" onchange="updateFileName(this)">
                    <div id="fileNameDisplay" style="font-size: 0.8rem; color: #666; margin-bottom: 10px; text-align: center;">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</div>

                    <textarea id="shipOnboard" class="board-input" placeholder="ë³¸ì„  ì‘ì—… íŠ¹ì§•"></textarea>
                    <textarea id="shipOnshore" class="board-input" placeholder="ìœ¡ìƒ ì‘ì—… íŠ¹ì§•"></textarea>
                    <div style="text-align: right;">
                        <button id="shipSubmitBtn" class="board-btn" style="background-color: #00897b;" onclick="addShipInfo()">ì •ë³´ ë“±ë¡</button>
                        <button id="shipCancelBtn" class="board-btn" style="background-color: #999; display:none; margin-left:5px;" onclick="resetShipForm()">ì·¨ì†Œ</button>
                    </div>
                    <div id="shipUploadProgress" style="color: #00897b; font-size: 0.8rem; margin-top: 5px; display: none;">ì‚¬ì§„ ì—…ë¡œë“œ ì¤‘...</div>
                </div>

                <ul id="shipList" class="post-list">
                    <li style="text-align:center; padding:20px; opacity:0.6;">ë¡œë”© ì¤‘...</li>
                </ul>
                <div id="shipPagination" class="pagination"></div>
            </div>
        </div>

        <div id="section-t3" class="section-card">
            <div class="section-title">3í•­ì—…</div>
            <div class="toggle-block bg-green" onclick="toggleTerminal('hjnc')">í•œì§„ (HJNC)</div>
            <div id="hjnc" class="hidden-content">
                <div class="btn-grid">
                    <a href="https://www.hjnc.co.kr/esvc/vessel/berthScheduleT" class="btn" target="_blank">ì„ ì„ ìŠ¤ì¼€ì¤„</a>
                    <a href="https://www.hjnc.co.kr/esvc/vessel/berthScheduleG" class="btn" target="_blank">ì„ ì„ ì°¨íŠ¸</a>
                    <a href="https://www.hjnc.co.kr/esvc/vessel/vesselStatus" class="btn" target="_blank">ì‘ì—… í˜„í™©</a>
                </div>
            </div>
            <div class="toggle-block bg-green" onclick="toggleTerminal('dgt')">ë™ì› (DGT)</div>
            <div id="dgt" class="hidden-content">
                <div class="btn-grid">
                    <a href="https://www.dgtbusan.com/DGT/esvc/vessel/berthScheduleT" class="btn" target="_blank">ì„ ì„ ìŠ¤ì¼€ì¤„</a>
                    <a href="https://www.dgtbusan.com/DGT/esvc/vessel/berthScheduleG" class="btn" target="_blank">ì„ ì„ ì°¨íŠ¸</a>
                    <a href="https://www.dgtbusan.com/DGT/esvc/vessel/vesselStatus" class="btn" target="_blank">ì‘ì—… í˜„í™©</a>
                </div>
            </div>
            <div class="toggle-block bg-green" onclick="toggleTerminal('bnct')">BNCT(ê³ ë ¤)</div>
            <div id="bnct" class="hidden-content">
                <div class="btn-grid">
                    <a href="https://info.bnctkorea.com/esvc/vessel/berthScheduleT" class="btn" target="_blank">ì„ ì„ ìŠ¤ì¼€ì¤„</a>
                    <a href="https://info.bnctkorea.com/esvc/vessel/berthScheduleG" class="btn" target="_blank">ì„ ì„ ì°¨íŠ¸</a>
                    <a href="https://info.bnctkorea.com/esvc/vessel/vesselStatus" class="btn" target="_blank">ì‘ì—… í˜„í™©</a>
                </div>
            </div>
            <div class="toggle-block bg-green" onclick="toggleTerminal('bct')">BCT</div>
            <div id="bct" class="hidden-content">
                <div class="btn-grid">
                    <a href="https://info.bct2-4.com/infoservice/index.html" class="btn" target="_blank">ì„ ì„ ìŠ¤ì¼€ì¤„</a>
                    <a href="https://info.bct2-4.com/infoservice/index.html" class="btn" target="_blank">ì„ ì„ ì°¨íŠ¸</a>
                    <a href="https://info.bct2-4.com/infoservice/index.html" class="btn" target="_blank">ì‘ì—… í˜„í™©</a>
                </div>
            </div>
        </div>

        <div id="section-t2" class="section-card">
            <div class="section-title">2í•­ì—…</div>
            <div class="toggle-block bg-blue" onclick="toggleTerminal('pnc')">PNC (ë¶€ì‚°ì‹ í•­ë§Œ)</div>
            <div id="pnc" class="hidden-content">
                <div class="btn-grid">
                    <a href="https://svc.pncport.com/info/CMS/Ship/Info.pnc?mCode=MN014" class="btn" target="_blank">ì„ ì„ ìŠ¤ì¼€ì¤„</a>
                    <a href="https://svc.pncport.com/info/CMS/Ship/ShipBerthC.pnc?mCode=MN019" class="btn" target="_blank">ì„ ì„ ì°¨íŠ¸</a>
                    <a href="https://svc.pncport.com/info/CMS/Ship/ShipVslStatus.pnc?mCode=MN020" class="btn" target="_blank">ì‘ì—… í˜„í™©</a>
                </div>
                <div style="margin-top: 5px;">
                    <button class="btn" style="width:100%; background-color:#fff3e0; color:#e65100; border:1px solid #ffcc80;" onclick="openBusSchedule()">ğŸšŒ PNC ì…”í‹€ë²„ìŠ¤ ì‹œê°„í‘œ</button>
                </div>
            </div>
            <div class="toggle-block bg-blue" onclick="toggleTerminal('pnit')">PNIT (ì‹ í•­êµ­ì œ)</div>
            <div id="pnit" class="hidden-content">
                <div class="btn-grid">
                    <a href="https://www.pnitl.com/infoservice/vessel/vslScheduleList.jsp" class="btn" target="_blank">ì„ ì„ ìŠ¤ì¼€ì¤„</a>
                    <a href="https://www.pnitl.com/infoservice/vessel/vslScheduleChart.jsp" class="btn" target="_blank">ì„ ì„ ì°¨íŠ¸</a>
                    <a href="https://www.pnitl.com/infoservice/vessel/vslWorkStatus.jsp" class="btn" target="_blank">ì‘ì—… í˜„í™©</a>
                </div>
            </div>
            <div class="toggle-block bg-blue" onclick="toggleTerminal('hpnt')">í˜„ëŒ€ (HPNT)</div>
            <div id="hpnt" class="hidden-content">
                <div class="btn-grid">
                    <a href="https://www.hpnt.co.kr/infoservice/vessel/vslScheduleList.jsp" class="btn" target="_blank">ì„ ì„ ìŠ¤ì¼€ì¤„</a>
                    <a href="https://www.hpnt.co.kr/infoservice/vessel/vslScheduleChart.jsp" class="btn" target="_blank">ì„ ì„ ì°¨íŠ¸</a>
                    <a href="https://www.hpnt.co.kr/infoservice/vessel/vslWorkStatus.jsp" class="btn" target="_blank">ì‘ì—… í˜„í™©</a>
                </div>
            </div>
        </div>

        <div id="section-t1" class="section-card">
            <div class="section-title">1í•­ì—…</div>
            <div class="toggle-block bg-khaki" onclick="toggleTerminal('north-port')">ë¶í•­ (North Port)</div>
            <div id="north-port" class="hidden-content">
                <div class="btn-grid">
                    <a href="http://info.bptc.co.kr:9084/content/sw/frame/berth_status_text_frame_sw_kr.jsp?p_id=BETX_SH_KR&snb_num=2&snb_div=service" class="btn" target="_blank">ê°ë§Œ / ì‹ ì„ ëŒ€</a>
                    <a href="https://custom.hktl.com/jsp/T01/sunsuk.jsp" class="btn" target="_blank">í—ˆì¹˜ìŠ¨</a>
                    <a href="http://info.bptc.co.kr:9084/content/index.jsp#03" class="btn" target="_blank">ë™ë¶€ (DPCT)</a>
                </div>
            </div>
        </div>

        <div id="section-control" class="section-card">
            <div class="section-title">ê´€ì œìƒí™© (ë„ì„ /ì„ ë°•ìœ„ì¹˜/ë‚ ì”¨)</div>
            <div class="toggle-block bg-purple" onclick="toggleTerminal('control')">ê´€ì œ ë° ê¸°ìƒ ì •ë³´</div>
            <div id="control" class="hidden-content">
                <div class="btn-grid">
                    <a href="http://www.busanpilot.co.kr/popup/monitoring" class="btn" target="_blank">ë„ì„  ì‹œê°„</a>
                    <a href="https://new.portmis.go.kr/" class="btn" target="_blank">PORT-MIS</a>
                    <a href="https://www.marinetraffic.com/en/ais/home/centerx:-12.0/centery:25.0/zoom:4" class="btn" target="_blank">ì„ ë°• ìœ„ì¹˜</a>
                    <a href="https://weather.naver.com/today/08440585" class="btn" target="_blank" style="color: #d32f2f;">â˜€ï¸ ë¶€ì‚° ë‚ ì”¨</a>
                </div>
            </div>
        </div>

    </div>

    <nav class="bottom-nav">
        <div class="nav-item" onclick="scrollToTop()">
            <span>ğŸ </span>í™ˆ
        </div>
        <div class="nav-item" onclick="activateTab('boardArea')">
            <span>ğŸ’¬</span>ê²Œì‹œíŒ
        </div>
        <div class="nav-item" onclick="activateTab('shipInfoArea')">
            <span>ğŸš¢</span>ì„ ë°•ì •ë³´
        </div>
        <div class="nav-item" onclick="activateTab('fileArea')">
            <span>ğŸ’¾</span>ìë£Œì‹¤
        </div>
    </nav>

    <div id="imageModal" class="modal-overlay" onclick="closeImageModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <img id="modalImage" src="" alt="í™•ëŒ€ ì´ë¯¸ì§€" class="modal-img">
            <button class="modal-close-btn" onclick="closeImageModal()">ë‹«ê¸°</button>
        </div>
    </div>

    <div id="bannerAdminModal" class="modal-overlay">
        <div class="modal-content">
            <h3 style="color:#003366;">ğŸš¨ ì•ˆì „ ë°°ë„ˆ ê´€ë¦¬</h3>
            <ul id="adminBannerList" class="admin-list"></ul>
            <div style="width:100%; margin-top:10px; display:flex; justify-content:space-between;">
                <button class="btn" style="width:48%; background:#e53935; color:white; border:none;" onclick="resetBannerMsg()">ì „ì²´ ì´ˆê¸°í™”</button>
                <button class="btn" style="width:48%;" onclick="document.getElementById('bannerAdminModal').style.display='none'">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        // -----------------------------------------------------------
        // API Key
        // -----------------------------------------------------------
        const firebaseConfig = {
            apiKey: "AIzaSyBDXy5HcYW-IZQJ9ZDEivr_yi99AxhYme8",
            authDomain: "my-app-d8527.firebaseapp.com",
            projectId: "my-app-d8527",
            storageBucket: "my-app-d8527.firebasestorage.app",
            messagingSenderId: "667323279185",
            appId: "1:667323279185:web:cff6184aaa82e08d345570",
            measurementId: "G-HZQLF0L77P"
        };

        let db, storage;
        let allPostsData = [], allShipsData = [], allFilesData = [];
        let currentBoardPage = 1, currentShipPage = 1, currentFilePage = 1;
        const postsPerPage = 5;
        let currentBannerMsgs = [];
        let editingShipId = null;

        try {
            if (firebase.apps.length === 0) firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            storage = firebase.storage();
            loadPostsRealtime();
            loadFilesRealtime();
            loadNoticesRealtime();
            loadShipsRealtime();
            loadBanner(); 
            if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
        } catch (e) { console.error("Firebase Init Error:", e); }

        // --- UI ê¸°ëŠ¥ ---
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }
        function scrollToTop() { window.scrollTo({ top: 0, behavior: 'smooth' }); }
        function activateTab(tabId) {
            document.getElementById('section-community').scrollIntoView({ behavior: 'smooth' });
            toggleView(tabId);
        }
        function toggleTerminal(id) {
            const el = document.getElementById(id);
            el.style.display = (el.style.display === "block") ? "none" : "block";
        }
        function toggleView(targetId) {
            const target = document.getElementById(targetId);
            const isVisible = target.style.display === "block";
            const all = ['noticeArea', 'boardArea', 'fileArea', 'shipInfoArea'];
            all.forEach(id => document.getElementById(id).style.display = 'none');
            if (!isVisible) target.style.display = 'block';
        }
        function toggleWriteForm(id) {
            const el = document.getElementById(id);
            el.style.display = (el.style.display === "none") ? "block" : "none";
        }
        function openBusSchedule() {
            showImageModal("https://firebasestorage.googleapis.com/v0/b/my-app-d8527.firebasestorage.app/o/archives%2F1769013796862_BandPhoto_2026_01_22_01_39_56.jpg?alt=media&token=a2e8f727-250a-41aa-855c-7b1f341d9048");
        }
        function showImageModal(src) {
            document.getElementById("modalImage").src = src;
            document.getElementById("imageModal").style.display = "flex";
        }
        function closeImageModal() { document.getElementById("imageModal").style.display = "none"; }
        function updateFileName(input) {
            const display = document.getElementById('fileNameDisplay');
            if(input.files && input.files.length > 0) {
                display.innerText = "âœ… " + input.files[0].name;
                display.style.color = "blue";
            } else {
                display.innerText = "ì„ íƒëœ íŒŒì¼ ì—†ìŒ";
                display.style.color = "#666";
            }
        }

        // --- Firebase Logic ---

        // 1. ì„ ë°• ì •ë³´ (ë¹„ë°€ë²ˆí˜¸ ì—†ìŒ, ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥)
        function resetShipForm() {
            editingShipId = null;
            document.getElementById('shipName').value = '';
            document.getElementById('shipOnboard').value = '';
            document.getElementById('shipOnshore').value = '';
            document.getElementById('shipFileInput').value = '';
            document.getElementById('fileNameDisplay').innerText = "ì„ íƒëœ íŒŒì¼ ì—†ìŒ";
            document.getElementById('shipSubmitBtn').innerText = "ì •ë³´ ë“±ë¡";
            document.getElementById('shipCancelBtn').style.display = 'none';
            document.getElementById('shipUploadProgress').style.display = 'none';
            document.getElementById('shipWriteForm').style.display = 'none';
        }

        function editShip(id) {
            const ship = allShipsData.find(s => s.id === id);
            if (!ship) return;

            editingShipId = id;
            document.getElementById('shipName').value = ship.shipName;
            document.getElementById('shipOnboard').value = ship.onboardFeat;
            document.getElementById('shipOnshore').value = ship.onshoreFeat;
            
            document.getElementById('shipWriteForm').style.display = 'block';
            document.getElementById('shipSubmitBtn').innerText = "ìˆ˜ì • ì™„ë£Œ";
            document.getElementById('shipCancelBtn').style.display = 'inline-block';
            
            document.getElementById('shipWriteForm').scrollIntoView({ behavior: 'smooth' });
        }

        function addShipInfo() {
            const name = document.getElementById('shipName').value.trim();
            const onboard = document.getElementById('shipOnboard').value;
            const onshore = document.getElementById('shipOnshore').value;
            const fileInput = document.getElementById('shipFileInput');
            const file = fileInput.files[0];

            if (!name) { alert("ì„ ë°• ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

            if (editingShipId) {
                processShipSave(name, onboard, onshore, file);
            } else {
                db.collection("ships").where("shipName", "==", name).get().then((querySnapshot) => {
                    if (!querySnapshot.empty) {
                        alert("âš ï¸ ë™ì¼í•œ ì„ ë°• ì´ë¦„ì´ ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì„ ë°•ì„ ì°¾ì•„ 'ìˆ˜ì •' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.");
                        return;
                    }
                    processShipSave(name, onboard, onshore, file);
                });
            }
        }

        function processShipSave(name, onboard, onshore, file) {
            if (file) {
                document.getElementById('shipUploadProgress').style.display = 'block';
                const fileName = 'ship_' + Date.now() + '_' + file.name;
                const ref = storage.ref('ships/' + fileName);
                ref.put(file).then(snapshot => snapshot.ref.getDownloadURL()).then(url => {
                    saveShipToDb(name, onboard, onshore, url);
                }).catch(err => {
                    alert("ì‚¬ì§„ ì—…ë¡œë“œ ì‹¤íŒ¨: " + err.message);
                    document.getElementById('shipUploadProgress').style.display = 'none';
                });
            } else {
                if (editingShipId) {
                     const original = allShipsData.find(s => s.id === editingShipId);
                     saveShipToDb(name, onboard, onshore, original.imageUrl); 
                } else {
                    saveShipToDb(name, onboard, onshore, null);
                }
            }
        }

        function saveShipToDb(name, onboard, onshore, imgUrl) {
            const data = {
                shipName: name, onboardFeat: onboard, onshoreFeat: onshore,
                imageUrl: imgUrl, date: new Date().toLocaleString(),
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };

            let promise;
            if (editingShipId) {
                promise = db.collection("ships").doc(editingShipId).update(data);
            } else {
                promise = db.collection("ships").add(data);
            }

            promise.then(() => {
                alert(editingShipId ? "ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤." : "ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
                resetShipForm();
            });
        }

        // [ìˆ˜ì •ëœ ë¶€ë¶„] ì‚­ì œ ì‹œ ê´€ë¦¬ì ì•”í˜¸ í™•ì¸
        function deleteShip(id, event) {
            event.stopPropagation();
            const pw = prompt("ê´€ë¦¬ì ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì‚­ì œ ê¶Œí•œ):");
            if(pw === "0346") {
                if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                    db.collection("ships").doc(id).delete().then(()=>alert("ì‚­ì œë¨"));
                }
            } else {
                alert("ì•”í˜¸ ì˜¤ë¥˜: ì‚­ì œëŠ” ê´€ë¦¬ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
            }
        }

        function loadShipsRealtime() {
            db.collection("ships").orderBy("shipName", "asc").onSnapshot(snapshot => {
                allShipsData = [];
                snapshot.forEach(doc => { let d = doc.data(); d.id = doc.id; allShipsData.push(d); });
                renderShipPage(1);
            });
        }

        function renderShipPage(page) {
            currentShipPage = page;
            const list = document.getElementById("shipList");
            list.innerHTML = "";
            
            if (allShipsData.length === 0) {
                list.innerHTML = '<li style="padding:20px; text-align:center; opacity:0.6;">ë“±ë¡ëœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
                document.getElementById("shipPagination").innerHTML = "";
                return;
            }

            const start = (page - 1) * postsPerPage;
            const end = start + postsPerPage;
            const items = allShipsData.slice(start, end);

            items.forEach(ship => {
                let imgBtn = "";
                if (ship.imageUrl) {
                    imgBtn = `<button class="photo-btn" onclick="event.stopPropagation(); showImageModal('${ship.imageUrl}')">ğŸ“· ì‚¬ì§„</button>`;
                }

                const li = document.createElement("li");
                li.className = "post-item";
                li.innerHTML = `
                    <div class="post-header" style="background-color:rgba(0, 137, 123, 0.1);" onclick="toggleContent('ship-${ship.id}')">
                        <span class="post-title" style="color:#00695c;">ğŸš¢ ${ship.shipName}</span>
                        <div>${imgBtn}</div>
                        <button class="edit-btn" onclick="event.stopPropagation(); editShip('${ship.id}')">âœï¸ ìˆ˜ì •</button>
                        <button class="delete-btn" onclick="deleteShip('${ship.id}', event)">ì‚­ì œ</button>
                        <span class="post-info" style="margin-left:5px;">â–¼</span>
                    </div>
                    <div id="ship-${ship.id}" class="post-body-container">
                        <p><strong>[ë³¸ì„  ì‘ì—… íŠ¹ì§•]</strong><br>${ship.onboardFeat || '-'}</p>
                        <hr style="border:0; border-top:1px dashed #ccc; margin:10px 0;">
                        <p><strong>[ìœ¡ìƒ ì‘ì—… íŠ¹ì§•]</strong><br>${ship.onshoreFeat || '-'}</p>
                    </div>`;
                list.appendChild(li);
            });
            renderPagination("shipPagination", Math.ceil(allShipsData.length / postsPerPage), currentShipPage, renderShipPage);
        }

        // --- ê¸°íƒ€ ë¡œì§ (ë°°ë„ˆ, ê²Œì‹œíŒ ë“± ê¸°ì¡´ ìœ ì§€) ---
        function loadBanner() {
            db.collection('settings').doc('banner').onSnapshot(doc => {
                if(doc.exists && doc.data().messages && doc.data().messages.length > 0) {
                    currentBannerMsgs = doc.data().messages;
                    const fullText = currentBannerMsgs.map((msg, index) => `[${index+1}] ${msg}`).join(' ã€€/ã€€ ');
                    document.getElementById('tickerText').innerText = "ğŸš¨ " + fullText;
                } else {
                    currentBannerMsgs = [];
                    document.getElementById('tickerText').innerText = "ğŸš¨ ë“±ë¡ëœ ì•ˆì „ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤. (í´ë¦­í•˜ì—¬ ì‘ì„±)";
                }
            });
        }
        function updateBanner() {
            const newText = prompt("ì•ˆì „ ê³µì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ìƒˆ ê¸€ì€ 1ë²ˆìœ¼ë¡œ ë“±ë¡ë©ë‹ˆë‹¤):");
            if (!newText || newText.trim() === "") return;
            const bannerRef = db.collection('settings').doc('banner');
            bannerRef.get().then((doc) => {
                let messages = [];
                if (doc.exists && doc.data().messages) messages = doc.data().messages;
                messages.unshift(newText); 
                if (messages.length > 5) messages = messages.slice(0, 5); 
                bannerRef.set({ messages: messages });
            });
        }
        function openBannerAdmin() {
            if(prompt("ê´€ë¦¬ì ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”") !== "0346") { alert("ì•”í˜¸ ì˜¤ë¥˜"); return; }
            renderAdminBannerList();
            document.getElementById('bannerAdminModal').style.display = 'flex';
        }
        function renderAdminBannerList() {
            const list = document.getElementById('adminBannerList');
            list.innerHTML = "";
            if(currentBannerMsgs.length === 0) { list.innerHTML = "<li>ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</li>"; return; }
            currentBannerMsgs.forEach((msg, index) => {
                const li = document.createElement('li');
                li.className = 'admin-item';
                li.innerHTML = `<span>[${index+1}] ${msg}</span> <button class="admin-del-btn" onclick="deleteBannerMsg(${index})">ì‚­ì œ</button>`;
                list.appendChild(li);
            });
        }
        function deleteBannerMsg(index) {
            if(!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            const newMsgs = [...currentBannerMsgs];
            newMsgs.splice(index, 1);
            db.collection('settings').doc('banner').set({ messages: newMsgs }).then(() => renderAdminBannerList());
        }
        function resetBannerMsg() {
            if(!confirm("ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            db.collection('settings').doc('banner').set({ messages: [] }).then(() => { renderAdminBannerList(); alert("ì´ˆê¸°í™” ì™„ë£Œ"); });
        }

        // ìµëª… ê²Œì‹œíŒ
        function addPost() {
            const cat = document.getElementById('inputCategory').value;
            const title = document.getElementById('inputTitle').value;
            const name = document.getElementById('inputName').value;
            const pw = document.getElementById('inputPw').value;
            const content = document.getElementById('inputContent').value;
            if(!title || !name || !pw || !content) { alert("ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
            db.collection("posts").add({
                category: cat, title: title, name: name, password: pw, content: content,
                date: new Date().toLocaleString(), timestamp: firebase.firestore.FieldValue.serverTimestamp(), comments: []
            }).then(() => {
                alert("ë“±ë¡ë¨");
                document.getElementById('inputTitle').value = '';
                document.getElementById('inputContent').value = '';
                document.getElementById('inputPw').value = '';
                toggleWriteForm('boardWriteForm');
            });
        }
        function loadPostsRealtime() {
            db.collection("posts").orderBy("timestamp", "desc").onSnapshot(snapshot => {
                allPostsData = [];
                snapshot.forEach(doc => { let d = doc.data(); d.id = doc.id; allPostsData.push(d); });
                renderBoardPage(1);
            });
        }
        function renderBoardPage(page) {
            currentBoardPage = page;
            const list = document.getElementById("boardList");
            list.innerHTML = "";
            if (allPostsData.length === 0) { list.innerHTML = '<li style="padding:20px; text-align:center; opacity:0.6;">ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</li>'; document.getElementById("pagination").innerHTML = ""; return; }
            const start = (page - 1) * postsPerPage;
            const end = start + postsPerPage;
            const items = allPostsData.slice(start, end);
            items.forEach(post => {
                const commentsHtml = (post.comments || []).map(c => `<li class="comment-item"><span>â†ª ${c.text}</span><span style="font-size:0.7rem; color:#888;">${c.time}</span></li>`).join('');
                const cat = post.category || "ì¡ë‹´";
                const li = document.createElement("li");
                li.className = "post-item";
                li.id = "post-" + post.id;
                li.innerHTML = `<div class="post-header" onclick="toggleContent('body-${post.id}')"><span class="post-title"><span class="post-cat">[${cat}]</span> ${post.title}</span><span class="post-info">${post.name}<br>${post.date.split('. ')[1]}.${post.date.split('. ')[2]}</span><button class="delete-btn" onclick="deletePost('${post.id}', '${post.password}', event)">ì‚­ì œ</button></div><div id="body-${post.id}" class="post-body-container"><div class="post-content">${post.content}</div><div class="comment-section"><ul class="comment-list" id="comment-list-${post.id}">${commentsHtml}</ul><div class="comment-input-area" style="margin-top:10px;"><input type="text" id="comment-input-${post.id}" class="comment-input" placeholder="ëŒ“ê¸€"><button class="comment-btn" onclick="addComment('${post.id}')">ë“±ë¡</button></div></div></div>`;
                list.appendChild(li);
            });
            renderPagination("pagination", Math.ceil(allPostsData.length / postsPerPage), currentBoardPage, renderBoardPage);
        }
        function deletePost(postId, correctPw, event) {
            event.stopPropagation();
            const inputPw = prompt("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”");
            if (inputPw === "0346" || inputPw === correctPw) {
                if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) db.collection("posts").doc(postId).delete().then(()=>alert("ì‚­ì œë¨"));
            } else { alert("ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜"); }
        }
        function addComment(postId) {
            const input = document.getElementById(`comment-input-${postId}`);
            if (!input.value) return;
            const newComment = { text: input.value, time: new Date().toLocaleTimeString() };
            db.collection("posts").doc(postId).update({ comments: firebase.firestore.FieldValue.arrayUnion(newComment) }).then(() => input.value = '');
        }

        // ìë£Œì‹¤
        function uploadFile() {
            const file = document.getElementById('fileInput').files[0];
            const title = document.getElementById('fileTitle').value;
            const uploader = document.getElementById('fileUploader').value;
            if(!file || !title) { alert("íŒŒì¼ê³¼ ì œëª© ì…ë ¥ í•„ìš”"); return; }
            document.getElementById('uploadProgress').style.display = 'block';
            const ref = storage.ref('archives/' + Date.now() + '_' + file.name);
            ref.put(file).then(s => s.ref.getDownloadURL()).then(url => {
                db.collection("archives").add({ title, uploader, fileName: file.name, fileUrl: url, date: new Date().toLocaleString(), timestamp: firebase.firestore.FieldValue.serverTimestamp() });
                alert("ì™„ë£Œ");
                document.getElementById('fileTitle').value = '';
                document.getElementById('fileInput').value = '';
                document.getElementById('uploadProgress').style.display = 'none';
            });
        }
        function loadFilesRealtime() {
            db.collection("archives").orderBy("timestamp", "desc").onSnapshot(snapshot => {
                allFilesData = [];
                snapshot.forEach(doc => { let d = doc.data(); d.id = doc.id; allFilesData.push(d); });
                renderFilePage(1);
            });
        }
        function renderFilePage(page) {
            currentFilePage = page;
            const list = document.getElementById("fileList");
            list.innerHTML = "";
            if (allFilesData.length === 0) { list.innerHTML = '<li style="padding:20px; text-align:center; opacity:0.6;">ìë£Œ ì—†ìŒ</li>'; document.getElementById("filePagination").innerHTML = ""; return; }
            const start = (page - 1) * postsPerPage;
            const end = start + postsPerPage;
            const items = allFilesData.slice(start, end);
            items.forEach(f => {
                const li = document.createElement("li");
                li.className = "file-item";
                li.innerHTML = `<div style="flex:1; overflow:hidden;"><a href="${f.fileUrl}" target="_blank" class="file-link">ğŸ’¾ ${f.title}</a><div class="file-meta">${f.uploader} | ${f.date.split('. ')[1]}.${f.date.split('. ')[2]}</div></div><a href="${f.fileUrl}" target="_blank" download class="download-btn">ë‹¤ìš´</a>`;
                list.appendChild(li);
            });
            renderPagination("filePagination", Math.ceil(allFilesData.length / postsPerPage), currentFilePage, renderFilePage);
        }
        function filterFiles() {
            const filter = document.getElementById('fileSearch').value.toUpperCase();
            const li = document.getElementById("fileList").getElementsByTagName('li');
            for(let i=0; i<li.length; i++) { li[i].style.display = (li[i].textContent.toUpperCase().indexOf(filter) > -1) ? "flex" : "none"; }
        }

        // ê³µì§€ì‚¬í•­
        function addNotice() {
            if(prompt("ê´€ë¦¬ì ì•”í˜¸:") !== "0346") { alert("ì•”í˜¸ ì˜¤ë¥˜"); return; }
            const title = document.getElementById('noticeTitle').value;
            const name = document.getElementById('noticeName').value;
            const content = document.getElementById('noticeContent').value;
            if(!title || !content) return;
            db.collection("notices").add({ title, name, content, date: new Date().toLocaleString(), timestamp: firebase.firestore.FieldValue.serverTimestamp() })
            .then(() => { alert("ë“±ë¡ë¨"); document.getElementById('noticeTitle').value = ''; document.getElementById('noticeContent').value = ''; });
        }
        function loadNoticesRealtime() {
            db.collection("notices").orderBy("timestamp", "desc").onSnapshot(snapshot => {
                const list = document.getElementById("noticeList");
                list.innerHTML = "";
                if(snapshot.empty) { list.innerHTML = '<li style="padding:20px; text-align:center; opacity:0.6;">ê³µì§€ ì—†ìŒ</li>'; return; }
                snapshot.forEach(doc => {
                    const n = doc.data();
                    const li = document.createElement("li");
                    li.className = "post-item notice-item";
                    li.innerHTML = `<div class="post-header" onclick="toggleContent('n-${doc.id}')"><span class="post-title">ğŸ“¢ ${n.title}</span><span class="post-info">${n.date.split('. ')[1]}.${n.date.split('. ')[2]}</span><button class="delete-btn" onclick="deleteNotice('${doc.id}', event)">ì‚­ì œ</button></div><div id="n-${doc.id}" class="post-body-container"><div class="post-content" style="color:#d32f2f;">${n.content}</div></div>`;
                    list.appendChild(li);
                });
            });
        }
        function deleteNotice(id, event) {
            event.stopPropagation();
            if(prompt("ê´€ë¦¬ì ì•”í˜¸:") === "0346") db.collection("notices").doc(id).delete();
        }

        // ê³µí†µ
        function toggleContent(id) {
            const el = document.getElementById(id);
            el.style.display = (el.style.display === "block") ? "none" : "block";
        }
        function renderPagination(elementId, totalPages, currentPage, renderFunc) {
            const div = document.getElementById(elementId);
            div.innerHTML = "";
            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement("button");
                btn.className = "page-btn";
                if (i === currentPage) btn.classList.add("active");
                btn.innerText = i;
                btn.onclick = () => renderFunc(i);
                div.appendChild(btn);
            }
        }
    </script>
</body>
</html>