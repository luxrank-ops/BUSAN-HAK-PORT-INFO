<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì„ ì› í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body { font-family: Arial, sans-serif; margin:0; background:#f5f5f5; }
.dark-mode { background:#121212; color:#eee; }
header { background:#003366; color:#fff; padding:12px; text-align:center; }
section { padding:15px; }
input, textarea, button { margin:5px 0; padding:8px; width:100%; box-sizing:border-box; }
ul { list-style:none; padding:0; }
.post-item { background:#fff; margin-bottom:10px; padding:10px; border-radius:6px; }
.dark-mode .post-item { background:#1f1f1f; }
.post-header-row { display:flex; justify-content:space-between; cursor:pointer; }
.post-body-content { display:none; margin-top:8px; }
.mini-btn { padding:4px 8px; font-size:12px; }
.btn-del { background:#c0392b; color:#fff; border:none; }
</style>
</head>

<body>

<header>
  <h2>ğŸš¢ ì„ ì› í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</h2>
  <button onclick="toggleDarkMode()">ğŸŒ™ ë‹¤í¬ëª¨ë“œ</button>
</header>

<section>
<h3>ğŸ“¢ ê³µì§€ì‚¬í•­</h3>
<input id="noticeTitle" placeholder="ì œëª©">
<textarea id="noticeContent" placeholder="ë‚´ìš©"></textarea>
<button onclick="addNotice()">ê³µì§€ ë“±ë¡</button>
<ul id="noticeList"></ul>
</section>

<section>
<h3>ğŸ’¬ ìµëª… ê²Œì‹œíŒ</h3>
<input id="postTitle" placeholder="ì œëª©">
<textarea id="postContent" placeholder="ë‚´ìš©"></textarea>
<input id="postPw" type="password" placeholder="ì‚­ì œ ë¹„ë°€ë²ˆí˜¸">
<button onclick="addPost()">ê¸€ ë“±ë¡</button>
<ul id="boardList"></ul>
</section>

<section>
<h3>ğŸš¢ ì„ ë°• ì •ë³´</h3>
<input id="shipName" placeholder="ì„ ë°•ëª…">
<textarea id="shipOnboard" placeholder="ìŠ¹ì„  ì •ë³´"></textarea>
<button onclick="addShipInfo()">ì„ ë°• ë“±ë¡</button>
<input id="shipSearch" placeholder="ê²€ìƒ‰" oninput="filterShips()">
<ul id="shipList"></ul>
</section>

<section>
<h3>ğŸ“‚ ìë£Œì‹¤</h3>
<input id="fileTitle" placeholder="ìë£Œ ì œëª©">
<input type="file" id="fileInput" accept=".pdf,.jpg,.png,.docx">
<button onclick="uploadFile()">ì—…ë¡œë“œ</button>
<ul id="fileList"></ul>
</section>

<script>
/* ===============================
   Firebase ì„¤ì • (ì‚¬ìš©ì ì œê³µ)
================================ */
const firebaseConfig = {
  apiKey: "AIzaSyBDXy5HcYW-IZQJ9ZDEivr_yi99AxhYme8",
  authDomain: "my-app-d8527.firebaseapp.com",
  projectId: "my-app-d8527",
  storageBucket: "my-app-d8527.firebasestorage.app",
  messagingSenderId: "667323279185",
  appId: "1:667323279185:web:cff6184aaa82e08d345570"
};

firebase.initializeApp(firebaseConfig);

const db = firebase.firestore();
const storage = firebase.storage();

let allShipsData = [];
let filteredShips = [];

/* ===============================
   ê³µí†µ
================================ */
function toggleDarkMode(){
  document.body.classList.toggle("dark-mode");
  localStorage.setItem(
    "darkMode",
    document.body.classList.contains("dark-mode")
  );
}
if(localStorage.getItem("darkMode")==="true"){
  document.body.classList.add("dark-mode");
}

async function verifyAdmin(){
  const pw = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸:");
  const doc = await db.collection("settings").doc("admin").get();
  return doc.exists && doc.data().pw === pw;
}

/* ===============================
   ê³µì§€ì‚¬í•­
================================ */
async function addNotice(){
  if(!await verifyAdmin()) return alert("ê´€ë¦¬ì ê¶Œí•œ í•„ìš”");
  db.collection("notices").add({
    title: noticeTitle.value,
    content: noticeContent.value,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
}

function delNotice(id,e){
  e.stopPropagation();
  db.collection("notices").doc(id).delete();
}

function loadNotices(){
  db.collection("notices").orderBy("timestamp","desc")
  .onSnapshot(snap=>{
    noticeList.innerHTML="";
    snap.forEach(d=>{
      const n=d.data();
      noticeList.innerHTML+=`
      <li class="post-item">
        <div class="post-header-row">
          <b>${n.title}</b>
          <button class="mini-btn btn-del"
            onclick="delNotice('${d.id}',event)">ì‚­ì œ</button>
        </div>
        <div class="post-body-content" style="display:block">
          ${n.content}
        </div>
      </li>`;
    });
  });
}

/* ===============================
   ê²Œì‹œíŒ
================================ */
function addPost(){
  db.collection("posts").add({
    title: postTitle.value,
    content: postContent.value,
    password: postPw.value,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
}

function deletePost(id,pw,e){
  e.stopPropagation();
  if(prompt("ë¹„ë°€ë²ˆí˜¸ ì…ë ¥")===pw){
    db.collection("posts").doc(id).delete();
  }
}

function loadPosts(){
  db.collection("posts").orderBy("timestamp","desc")
  .onSnapshot(snap=>{
    boardList.innerHTML="";
    snap.forEach(d=>{
      const p=d.data();
      boardList.innerHTML+=`
      <li class="post-item">
        <div class="post-header-row"
          onclick="this.nextElementSibling.style.display=
          this.nextElementSibling.style.display==='block'?'none':'block'">
          <b>${p.title}</b><span>ìµëª…</span>
        </div>
        <div class="post-body-content">
          ${p.content}
          <button class="mini-btn btn-del"
            onclick="deletePost('${d.id}','${p.password}',event)">ì‚­ì œ</button>
        </div>
      </li>`;
    });
  });
}

/* ===============================
   ì„ ë°•
================================ */
function addShipInfo(){
  if(!shipName.value) return;
  db.collection("ships").doc(shipName.value).set({
    name: shipName.value,
    onboard: shipOnboard.value,
    updated: firebase.firestore.FieldValue.serverTimestamp()
  });
}

function loadShips(){
  db.collection("ships").orderBy("updated","desc")
  .onSnapshot(snap=>{
    allShipsData=[];
    snap.forEach(d=>allShipsData.push(d.data()));
    filteredShips=[...allShipsData];
    renderShips();
  });
}

function renderShips(){
  shipList.innerHTML="";
  filteredShips.forEach(s=>{
    shipList.innerHTML+=`
    <li class="post-item">
      <b>${s.name}</b>
      <div style="display:block">${s.onboard}</div>
    </li>`;
  });
}

function filterShips(){
  const q=shipSearch.value.toLowerCase();
  filteredShips=allShipsData.filter(
    s=>s.name.toLowerCase().includes(q)
  );
  renderShips();
}

/* ===============================
   ìë£Œì‹¤
================================ */
function uploadFile(){
  const f=fileInput.files[0];
  if(!f) return;
  const ref=storage.ref("files/"+Date.now()+"_"+f.name);
  ref.put(f).then(snap=>{
    snap.ref.getDownloadURL().then(url=>{
      db.collection("archives").add({
        title:fileTitle.value,
        url,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
    });
  });
}

function delArchive(id,e){
  e.stopPropagation();
  db.collection("archives").doc(id).delete();
}

function loadFiles(){
  db.collection("archives").orderBy("timestamp","desc")
  .onSnapshot(snap=>{
    fileList.innerHTML="";
    snap.forEach(d=>{
      const f=d.data();
      fileList.innerHTML+=`
      <li class="post-item">
        <a href="${f.url}" target="_blank">${f.title}</a>
        <button class="mini-btn btn-del"
          onclick="delArchive('${d.id}',event)">ì‚­ì œ</button>
      </li>`;
    });
  });
}

/* ===============================
   ì´ˆê¸° ë¡œë“œ
================================ */
function loadAllData(){
  loadNotices();
  loadPosts();
  loadShips();
  loadFiles();
}
window.onload = loadAllData;
</script>

</body>
</html>
